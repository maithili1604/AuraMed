<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Font Awesome for icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Add this in the <head> of your HTML if not already included -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Include Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-messaging-compat.js"></script>
    

    <title>Hospital Homepage</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      body {
        background-color: #ffe6e6;
      }

      .container {
        display: grid;
        grid-template-columns: 80px 1fr 200px;
        gap: 20px;
        padding: 20px;
        min-height: 100vh;
      }

      /* Header styles */
      .header {
        display: flex;
        align-items: center;
        gap: 20px;
        grid-column: 1 / -1;
        padding-bottom: 20px;
      }

      .logo {
        display: flex;
        align-items: center;
      }

      .logo-img {
        width: 80px; /* Adjust image size as needed */
        height: auto; /* Maintain aspect ratio */
        margin-right: 15px; /* Space between image and name */
      }

      .logo-name {
        font-size: 24px;
        font-weight: bold;
        color: #009688; /* Set the color to #009688 */
      }

      .search-bar {
        flex-grow: 1;
        max-width: 600px;
        position: relative;
        margin: 20px auto;
      }

      .search-bar input {
        width: 100%;
        padding: 12px 40px;
        border: 2px solid #009688;
        border-radius: 25px;
        font-size: 16px;
        outline: none;
      }

      .search-bar::after {
        content: "üîç";
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
        color: #009688;
        cursor: pointer;
      }

      #search-results {
        margin-top: 10px;
        padding: 10px;
        border: 2px solid #009688;
        border-radius: 10px;
        background-color: #f9f9f9;
        max-width: 600px;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        font-family: Arial, sans-serif;
        font-size: 14px;
        color: #333;
        display: none; /* Initially hidden */
        position: absolute;
        z-index: 1000;
        width: 100%;
      }

      #search-results h3 {
        font-size: 16px;
        font-weight: bold;
        color: #009688;
        margin-bottom: 5px;
      }

      #search-results div {
        padding: 5px 0;
        border-bottom: 1px solid #ddd;
      }

      #search-results div:last-child {
        border-bottom: none;
      }

      .profile-button {
        background-color: transparent;
        border: none;
        cursor: pointer;
        margin-left: auto; /* Push the button to the right */
        position: relative;
      }

      .profile-icon {
        font-size: 40px;
        color: #ffa726; /* Light orange color */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* Sidebar styles */
      .sidebar {
        display: flex;
        flex-direction: column;
        gap: 30px;
        padding: 40px 0; /* Increased padding for better centering */
        background-color: #fff;
        border-radius: 15px;
        align-items: center;
        justify-content: center; /* Center icons vertically */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Sidebar shadow */
        position: relative;
      }

      /* Sidebar container */
      .sidebar {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 30px;
        padding: 20px 0;
        background-color: #fff;
        border-radius: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */
        width: 80px; /* Fixed width for horizontal centering */
      }

      /* Sidebar items (icon + tooltip) */
      .sidebar-item {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* Center items horizontally */
        text-decoration: none;
      }

      /* Sidebar icons */
      .sidebar-icon {
        font-size: 24px;
        color: #009688;
        transition: transform 0.2s, color 0.2s;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center; /* Center icon inside its container */
      }

      /* Hover effect for icons */
      .sidebar-icon:hover {
        color: #005f56; /* Slightly darker green */
        transform: scale(1.1); /* Slight enlargement */
      }

      /* Tooltip design */
      .sidebar-tooltip {
        position: absolute;
        left: 90px; /* Tooltip appears to the right of the icon */
        top: 50%; /* Center tooltip vertically relative to the icon */
        transform: translateY(-50%);
        background-color: #ffe6e6; /* Light pink background */
        color: #333;
        font-size: 14px;
        padding: 5px 10px;
        border-radius: 15px; /* Rounded "cloud" effect */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Subtle shadow */
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        z-index: 100; /* Ensures tooltip appears above all elements */
        transition: opacity 0.2s, transform 0.2s;
      }

      /* Show tooltip on hover */
      .sidebar-item:hover .sidebar-tooltip {
        opacity: 1;
        transform: translateY(-50%) translateX(10px); /* Slight shift for hover */
      }

      /* Main content styles */
      .main-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      /* Carousel container */
      .carousel-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .carousel {
        position: relative;
        height: 300px;
        background: #fff;
        border-radius: 15px;
        overflow: hidden;
      }

      .carousel-inner {
        display: flex;
        transition: transform 0.5s ease;
        height: 100%;
      }

      .carousel-slide {
        min-width: 100%;
        height: 100%;
      }

      .carousel-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .carousel-buttons {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
      }

      .carousel-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
      }

      .carousel-dot.active {
        background: #fff;
      }

      /* Map and Hospital List Container */
      .map-hospitals-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        height: 400px; /* Sets the overall container height */
      }

      /* Map Container */
      .map-container {
        background-color: #fff;
        border-radius: 15px;
        overflow: hidden;
        height: 100%; /* Matches the container height */
      }

      /* Hospitals List */
      .hospitals-list {
        background: #fff;
        border-radius: 15px;
        padding: 20px;
        overflow-y: auto;
        height: 100%; /* Matches the container height */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .hospital-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.2s;
      }

      .hospital-item:hover {
        background-color: #f5f5f5;
        transform: scale(1.02);
      }

      .hospital-icon {
        width: 50px;
        height: 50px;
        background-color: #009688;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .hospital-info h3 {
        margin-bottom: 5px;
        color: #333;
        font-size: 18px;
        font-weight: bold;
      }

      .hospital-info p {
        color: #666;
        font-size: 14px;
        margin: 0;
      }

      .popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #ffe6e6;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        width: 90%; /* Still responsive with percentage width */
        max-width: 600px; /* Increased max width */
      }

      .popup h2 {
        color: #333;
        margin-bottom: 15px;
      }

      .popup button {
        background-color: #009688;
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px 5px;
        transition: background-color 0.3s ease;
      }

      .popup button:hover {
        background-color: #00796b;
      }

      form {
        max-height: 400px; /* Adjust the height as needed */
        overflow-y: auto; /* Enables vertical scrolling */
        padding-right: 10px; /* Optional: to add some space on the right side */
      }

      form label {
        display: block;
        margin: 10px 0 5px;
        color: #333;
        font-weight: bold;
      }

      form input,
      form select {
        width: calc(100% - 20px);
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
      }

      form button[type="submit"] {
        background-color: #009688;
        color: #fff;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      form button[type="submit"]:hover {
        background-color: #00796b;
      }

      /* Shared styling for all action buttons */
      .action-button {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        background-color: #fff;
        border-radius: 15px;
        cursor: pointer;
        transition: transform 0.2s;
        margin-bottom: 15px; /* Add spacing between buttons */
      }

      .action-button:hover {
        transform: scale(1.05);
      }

      /* Individual button icon and text styling */

      /* Book Appointment */
      .book-appointment i {
        margin-top: 10px;
        font-size: 24px;
        color: #009688;
        margin-bottom: 10px;
      }

      .book-appointment span {
        text-align: center;
        color: #333;
        font-size: 14px;
      }

      /* Video Consultation */
      .chatbot-button i {
        font-size: 24px;
        color: #009688;
        margin-bottom: 10px;
      }

      .chatbot-button span {
        text-align: center;
        color: #333;
        font-size: 14px;
      }

      /* Bed Vacancy */
      .bed-vacancy i {
        font-size: 24px;
        color: #009688;
        margin-bottom: 10px;
      }

      .bed-vacancy span {
        text-align: center;
        color: #333;
        font-size: 14px;
      }

      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }

      .input-field {
        display: block;
        margin-bottom: 10px;
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      #profile-image {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        display: block;
        margin: 0 auto 10px;
      }

      #profile-image-upload {
        display: none;
      }

      #save-profile {
        display: none;
      }
      #health-data-button {
        width: 40px;
        height: 40px;
        color: #009688; /* Default color consistent with other icons */
        font-size: 24px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: transform 0.2s, color 0.2s, box-shadow 0.2s;
      }

      #health-data-button:hover {
        color: #005f56; /* Darker hover color consistent with other icons */
        transform: scale(1.1); /* Same hover scaling effect */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Hover shadow for consistency */
        border-radius: 50%; /* Rounded background effect on hover */
        background-color: rgba(0, 150, 136, 0.1); /* Subtle background effect */
      }

      #health-data-card {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .data-row {
        font-size: 16px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
      }

      .data-row i {
        margin-right: 10px;
        font-size: 20px;
        color: #009688;
      }

      #no-health-data {
        text-align: center;
        margin-top: 20px;
      }

      #no-health-data p {
        font-size: 18px;
      }

      #no-health-data button {
        margin-top: 10px;
      }

      #health-data-form {
        display: block;
      }

      #health-data-form .input-group {
        margin-bottom: 15px;
      }

      #health-data-form label {
        font-size: 16px;
        margin-bottom: 5px;
      }

      #health-data-form input,
      #health-data-form select {
        width: 100%;
        padding: 8px;
        font-size: 16px;
        border-radius: 4px;
        border: 1px solid #ccc;
      }

      #health-data-form button {
        margin-top: 15px;
        background-color: #009688;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
      }

      #close-popup {
        background-color: #f44336;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        margin-top: 10px;
      }

      #close-popup:hover {
        background-color: #e53935;
      }

      .btn {
        cursor: pointer;
      }

      button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }

      #edit-health-data {
        margin-top: 20px;
        background-color: #4caf50;
        color: white;
      }

      #edit-health-data:hover {
        background-color: #45a049;
      }

      #health-data-display {
        display: block;
      }

      #health-data-display span {
        font-weight: 600;
        color: #333;
      }

      #health-data-display i {
        color: #009688;
      }
      /* Modal Styling */
      .modal {
        display: none; /* Hidden by default */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        z-index: 1000;
      }

      .modal.active {
        display: block; /* Show modal when active */
      }

      .modal-content {
        background-color: #fff;
        margin: 5% auto;
        padding: 20px;
        border-radius: 12px;
        width: 70%;
        max-width: 900px;
        position: relative;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        font-family: "Arial", sans-serif;
      }

      /* Close button styling */
      .close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 20px;
        color: #666;
        cursor: pointer;
        background: none;
        border: none;
        transition: color 0.3s;
      }

      .close:hover {
        color: #333; /* Darker shade on hover */
      }
      /* General Styling for Tables */
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 16px;
        text-align: left;
      }

      table thead th {
        background-color: #009688; /* Teal background for header */
        color: #fff; /* White text for header */
        padding: 12px 15px;
        text-align: center;
      }

      table tbody tr {
        background-color: #ffe6e6; /* Light pink rows */
        color: #666; /* Medium gray text */
        border-bottom: 1px solid #ddd; /* Subtle border between rows */
        transition: background-color 0.3s;
      }

      table tbody tr:hover {
        background-color: #ffdede; /* Slightly darker pink on hover */
      }

      table tbody td {
        padding: 10px 15px;
        text-align: center;
      }

      table tbody td a {
        color: #009688; /* Teal links for reports */
        text-decoration: none;
        font-weight: bold;
        transition: color 0.3s;
      }

      table tbody td a:hover {
        color: #00695c; /* Darker teal on hover */
      }

      /* Buttons Styling */
      button {
        padding: 8px 12px;
        font-size: 14px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      button.btn-danger {
        background-color: #e57373; /* Light red */
        color: #fff; /* White text */
      }

      button.btn-danger:hover {
        background-color: #d32f2f; /* Darker red */
      }

      button.btn-warning {
        background-color: #ffb74d; /* Amber */
        color: #fff; /* White text */
      }

      button.btn-warning:hover {
        background-color: #f57c00; /* Darker amber */
      }

      /* Headings Styling */
      h1,
      h2 {
        color: #333; /* Dark gray headings */
        margin-bottom: 15px;
        font-weight: bold;
      }

      h1 {
        font-size: 24px;
      }

      h2 {
        font-size: 20px;
      }

      /* Dashboard Section Styling */
      .dashboard-section {
        margin-bottom: 30px;
        padding: 10px 20px;
        border-radius: 8px;
        background-color: #fff; /* White card-like section */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */
      }

      /* Scrollable Modal Content */
      .modal-content {
        max-height: 80vh; /* Limit height for content */
        overflow-y: auto; /* Add scroll if content overflows */
      }

      /* Responsiveness */
      @media (max-width: 768px) {
        .modal-content {
          width: 90%; /* Adjust width on smaller screens */
          padding: 15px;
        }

        table tbody td,
        table thead th {
          font-size: 14px; /* Smaller text for compact view */
        }

        button {
          font-size: 12px; /* Smaller button text */
          padding: 6px 10px;
        }
      }
      /* Modal Content Styling for Inputs and Selects */
      .modal-content select,
      .modal-content input {
        display: block;
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd; /* Consistent with modal borders */
        border-radius: 5px; /* Rounded corners */
        font-size: 16px; /* Consistent font size with modal content */
        background-color: #fff; /* White background to match modal content */
        color: #333; /* Dark text color for readability */
        box-sizing: border-box; /* Ensure padding is included in the width */
      }

      /* Hover effect for inputs and selects */
      .modal-content select:hover,
      .modal-content input:hover {
        border-color: #009688; /* Teal border on hover */
      }

      /* Focus effect for inputs and selects */
      .modal-content select:focus,
      .modal-content input:focus {
        outline: none; /* Remove default focus outline */
        border-color: #009688; /* Teal border when focused */
        box-shadow: 0 0 4px rgba(0, 150, 136, 0.4); /* Light shadow for focus effect */
      }

      /* Scrollable Form Container */
      .scrollable-form-container {
        overflow-y: auto;
        padding: 10px;
        max-height: calc(80vh - 40px); /* Responsive height */
      }

      /* Fieldset and Legend */
      fieldset {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
        background-color: #fff;
      }

      legend {
        padding: 0 10px;
        font-weight: bold;
        color: #009688;
      }

      /* Labels and Inputs */
      form label {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      form input,
      form select {
        width: 100%;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
        margin-bottom: 10px;
      }

      form input:focus,
      form select:focus {
        outline: none;
        border-color: #009688;
        box-shadow: 0 0 5px rgba(0, 150, 136, 0.5);
      }

      /* Form Actions */
      .form-actions-container {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin-top: 15px;
      }

      .form-actions-container button {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        background-color: #009688;
        color: white;
        font-weight: bold;
        transition: background-color 0.3s ease;
      }

      .form-actions-container button:hover {
        background-color: #00796b;
      }

      /* Close button */
      .form-actions-container .close-btn {
        background-color: #e57373;
      }

      .form-actions-container .close-btn:hover {
        background-color: #d32f2f;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .scrollable-form-container {
          max-height: calc(70vh - 40px);
        }

        .form-actions-container button {
          font-size: 14px;
        }
      }
      /* Style the container for the hospital dropdown and search bar */
      .hospital-dropdown-container {
        position: relative;
        width: 100%;
      }

      #hospitalSearch {
        width: 100%;
        padding: 10px;
        margin-bottom: 5px;
        box-sizing: border-box;
      }

      #hospitalName {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
      }

      /* Popup Header */
      .popup-header-health {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 10px;
        background-color: #f4f4f4;
        border-radius: 5px;
      }

      .popup-header-health h2 {
        color: #333;
        margin: 0;
        font-size: 20px;
      }

      .popup-header-health button {
        background-color: transparent;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #333;
      }

      .popup-header-health button:hover {
        color: #005f5f;
      }

      /* Tab Menu */
      .tab-menu-health {
        display: flex;
        margin-bottom: 15px;
        border-bottom: 2px solid #ddd;
      }

      .tab-menu-health button {
        flex: 1;
        padding: 12px;
        border: none;
        background: transparent;
        font-weight: bold;
        cursor: pointer;
        text-align: center;
        font-size: 16px;
        color: #555;
        border-bottom: 2px solid transparent;
        transition: border-bottom 0.3s ease, color 0.3s ease;
      }

      .tab-menu-health button.active {
        border-bottom: 2px solid #00796b;
        color: #00796b;
      }

      .tab-content-health {
        display: none;
        overflow-y: auto; /* Enables scrolling in content */
      }

      .tab-content-health.active {
        display: block;
        max-height: 400px; /* Set max height for scrolling */
      }

      /* Form Input Groups */
      .input-group-health {
        margin-bottom: 20px;
        width: 100%;
      }

      .input-group-health label {
        font-size: 14px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      .input-group-health input,
      .input-group-health select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
      }

      .input-group-health input:focus,
      .input-group-health select:focus {
        border-color: #00796b;
        outline: none;
      }

      /* Buttons */
      button-health {
        background-color: #00796b;
        color: #fff;
        border: none;
        padding: 12px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        font-size: 16px;
        font-weight: bold;
      }

      button-health:hover {
        background-color: #004d40;
      }

      button-health:focus {
        outline: none;
      }

      /* Upload Section */
      .upload-section-health {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
        padding: 15px;
        background-color: #f9f9f9;
        border-radius: 5px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        overflow-y: auto; /* Enables scrolling in the upload section */
        max-height: 300px; /* Set max height for scrolling */
      }

      .upload-list-health {
        list-style: none;
        padding: 0;
        margin: 20px 0 0;
        width: 100%;
        max-height: 200px; /* Set max height to restrict the list */
        overflow-y: auto; /* Enable scrolling for long lists */
      }

      .upload-list-health li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #ddd;
      }

      .upload-list-health li:last-child {
        border-bottom: none;
      }

      .upload-list-health a {
        color: #00796b;
        text-decoration: none;
        font-weight: bold;
        font-size: 14px;
        transition: color 0.3s ease;
      }

      .upload-list-health a:hover {
        color: #004d40;
      }

      /* Prescription and Report Tabs */
      #prescriptions-tab-health,
      #reports-tab-health {
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 5px;
        overflow-y: auto; /* Enables scrolling in these sections */
        max-height: 400px; /* Set max height for scrolling */
      }

      /* Modal or Popup Styling */
      .popup-header-health,
      .tab-menu-health,
      .upload-section-health {
        border-radius: 5px;
      }

      .upload-section-health input[type="file"] {
        padding: 12px;
        width: 100%;
        font-size: 14px;
      }

      .upload-section-health button {
        background-color: #00796b;
        color: #fff;
        font-weight: bold;
      }

      .upload-section-health button:hover {
        background-color: #004d40;
      }

      .upload-list-health {
        margin-top: 10px;
      }

      .upload-list-health li {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        border-bottom: 1px solid #ccc;
      }

      .upload-list-health li:last-child {
        border-bottom: none;
      }

      /* Responsive Design for smaller screens */
      @media (max-width: 768px) {
        .upload-item-health {
          flex-direction: column;
          align-items: flex-start;
        }

        .upload-item-actions-health {
          margin-top: 10px;
        }
      }

      /* Notification Box */
      .notification-box {
        background-color: #fff;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        max-height: 300px; /* Scrollable if content overflows */
        overflow-y: auto;
        margin-bottom: 30px;
      }

      /* Notification Item */
      .notification-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        margin-bottom: 10px;
        background-color: #f9f9f9;
        border-radius: 10px;
        transition: transform 0.2s, background-color 0.2s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .notification-item:hover {
        transform: scale(1.02);
        background-color: #f3f3f3;
      }

      /* Notification Text */
      .notification-item p {
        margin: 0;
        font-size: 14px;
        color: #333;
        flex-grow: 1; /* Makes the text take available space */
      }

      /* Read Button */
      .notification-item button {
        background-color: #ffa726; /* Light orange color */
        border: none;
        border-radius: 5px;
        padding: 5px 10px;
        color: #fff;
        font-size: 12px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
      }

      .notification-item button:hover {
        background-color: #fb8c00; /* Darker orange on hover */
        transform: scale(1.05);
      }

      /* Container for prescriptions and reports */
      .upload-item {
        background-color: #fff; /* White background for list items */
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
        padding: 15px;
        display: flex;
        flex-direction: column;
      }

      .upload-item-content {
        margin-bottom: 10px;
      }

      .upload-item-content span {
        display: block;
        margin: 5px 0;
        color: #666; /* Medium gray text for item details */
      }

      /* Strong text styling */
      .upload-item-content strong {
        color: #333; /* Dark gray color for headings */
      }

      /* Button styling for 'View' link */
      .upload-item-actions {
        margin-top: 10px;
      }

      .upload-item-actions .btn-link {
        color: #009688; /* Teal accent color */
        text-decoration: none;
        font-weight: bold;
      }

      .upload-item-actions .btn-link:hover {
        color: #00796b; /* Darker teal for hover effect */
        text-decoration: underline;
      }

      /* Header styling */
      h2 {
        color: #333;
        font-size: 24px;
        margin-bottom: 20px;
      }

      /* Styling for prescription and report lists */
      #prescription-list-health,
      #report-list-health {
        list-style-type: none;
        padding: 0;
      }

      /* Optional: Style for empty states */
      .upload-item.empty {
        text-align: center;
        color: #666;
        font-style: italic;
      }

      #book-appointment-button {
        background-color: #ffa726; /* Light orange background */
        color: white; /* White text */
        padding: 10px 20px; /* Add padding for a larger button */
        font-size: 16px; /* Make the text larger */
        border: none; /* Remove border */
        border-radius: 5px; /* Add rounded corners */
        cursor: pointer; /* Change cursor to pointer on hover */
        transition: background-color 0.3s, transform 0.2s; /* Smooth transition for hover effects */
      }

      /* Hover effect */
      #book-appointment-button:hover {
        background-color: #fb8c00; /* Darker orange on hover */
        transform: scale(1.05); /* Slightly enlarge button on hover */
      }

      /* Active (pressed) effect */
      #book-appointment-button:active {
        background-color: #ef6c00; /* Even darker orange */
        transform: scale(0.95); /* Slightly shrink button on click */
      }

      /* General Styling for Submit Buttons */
      #reschedule-submit,
      #adjust-submit {
        background-color: #ffa726; /* Light orange background */
        color: white; /* White text */
        padding: 10px 20px; /* Add padding for better click area */
        font-size: 16px; /* Comfortable font size */
        font-weight: bold; /* Make the text bold */
        border: none; /* Remove default border */
        border-radius: 5px; /* Rounded corners for a modern look */
        cursor: pointer; /* Change cursor to pointer on hover */
        transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth hover effect */
        display: inline-block; /* Align neatly in form layout */
        margin-top: 15px; /* Add spacing above */
      }

      /* Hover Effect */
      #reschedule-submit:hover,
      #adjust-submit:hover {
        background-color: #fb8c00; /* Slightly darker orange on hover */
        transform: scale(1.05); /* Slight enlargement for interactivity */
      }

      /* Active Effect */
      #reschedule-submit:active,
      #adjust-submit:active {
        background-color: #ef6c00; /* Even darker orange when clicked */
        transform: scale(0.95); /* Slight shrink on click for press effect */
      }

      /* Disabled State (Optional) */
      #reschedule-submit:disabled,
      #adjust-submit:disabled {
        background-color: #ffe0b2; /* Light orange-gray for disabled state */
        color: #fff; /* Keep white text */
        cursor: not-allowed; /* Show disabled cursor */
        opacity: 0.7; /* Dim the button */
      }

      .sidebar-item a {
        text-decoration: none; /* Removes underline */
      }

      .logout-icon {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        color: #009688; /* Customize the color */
        cursor: pointer;
        text-decoration: none;
      }

      .logout-icon:hover {
        color: #ff5722; /* Change to a hover color, like orange */
      }

      .input-wrapper {
        position: relative;
        margin-bottom: 10px;
      }

      .input-wrapper i {
        position: absolute;
        top: 50%;
        left: 10px;
        transform: translateY(-50%);
        color: #999;
      }

      .input-wrapper .input-field {
        padding-left: 30px;
      }

      footer {
        background-color: var(--primary-color);
        color: var(--card-background);
        padding: 2rem 2rem;
        text-align: center;
      }

      footer a {
        color: var(--background-color);
        text-decoration: none;
        transition: color 0.3s;
      }

      footer a:hover {
        color: var(--card-background);
      }

      /* Chatbot Modal Styles */
      .chatbot-modal {
        display: none; /* Hidden by default */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(
          0,
          0,
          0,
          0.5
        ); /* Black background with transparency */
        z-index: 1000;
      }

      .chatbot-modal-content {
        background-color: #fff; /* White background */
        border-radius: 8px;
        width: 400px;
        max-width: 90%;
        margin: 100px auto;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        position: relative;
        text-align: center;
      }

      /* Modal Close Button */
      .chatbot-modal-close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 20px;
        font-weight: bold;
        color: #666; /* Medium gray */
        cursor: pointer;
        transition: color 0.3s ease;
      }

      .chatbot-modal-close:hover {
        color: #009688; /* Teal */
      }
      /* Waiting List Box */
      .waiting-list-box {
        background-color: #fff;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        max-height: 300px; /* Scrollable if content overflows */
        overflow-y: auto;
        margin-bottom: 30px;
      }
      
      /* Waiting List Item */
      .waiting-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        margin-bottom: 10px;
        background-color: #f9f9f9;
        border-radius: 10px;
        transition: transform 0.2s, background-color 0.2s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .waiting-list-item:hover {
        transform: scale(1.02);
        background-color: #f3f3f3;
      }
      
      /* Waiting List Text */
      .waiting-list-item p {
        margin: 0;
        font-size: 14px;
        color: #333;
        flex-grow: 1; /* Makes the text take available space */
      }
      .sos-button {
        background-color: red;
        color: white;
        border: none;
        padding: 10px 15px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        border-radius: 5px;
        margin-left: 10px;
      }
    
      .sos-button:hover {
        background-color: darkred;
      }

      .dropdown-container {
        margin: 20px;
      }
      label {
        font-size: 16px;
        margin-bottom: 5px;
        display: block;
      }
      select {
        width: 200px;
        height: 120px; /* Adjust height to show multiple options */
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <div class="logo">
          <img
            src="static/AuraMedlogo.png"
            alt="AuraMed Logo"
            class="logo-img"
          />
          <span class="logo-name">AuraMed</span>
        </div>

        <div class="search-bar">
          <input
            type="text"
            id="search-input"
            placeholder="Search for hospitals/doctors"
          />
          <div id="search-results" style="display: none"></div>
        </div>
          <!-- SOS Button (Starts Recording on Click) -->
    <button class="sos-button" id="sos-button">
      üö® SOS
    </button>
    <!-- ‚úÖ Ensure this exists -->
  <p id="sos-status">Press the SOS button in an emergency.</p>
        <!-- Profile Button -->
        <button class="profile-button" id="profile-button">
          <div class="profile-icon">&#128100;</div>
          <!-- Unicode for profile icon -->
        </button>
      </header>

      <aside class="sidebar">
        <div class="sidebar-item">
          <i
            class="fas fa-calendar-check sidebar-icon"
            id="open-modal"
            data-title="Dashboard"
          ></i>
          <!-- Changed icon -->
          <span class="sidebar-tooltip">Appointment & Test Records</span>
        </div>
        <div class="sidebar-item">
          <a
            href="/disease"
            class="fas fa-stethoscope sidebar-icon"
            data-title="Search"
          ></a>
          <!-- No underline -->
          <span class="sidebar-tooltip">Symptom Checker</span>
        </div>
        <div class="sidebar-item">
          <i
            class="fas fa-heart sidebar-icon"
            id="health-data-button"
            data-title="Health Data"
          ></i>
          <span class="sidebar-tooltip">Health Record</span>
        </div>
        <div class="sidebar-item">
          <i class="fas fa-comment sidebar-icon" data-title="Comments"></i>
          <span class="sidebar-tooltip">Chat with us</span>
        </div>
        <div class="sidebar-item">
          <i class="fas fa-users sidebar-icon" data-title="Users"></i>
          <span class="sidebar-tooltip">About Us</span>
        </div>
        <div class="sidebar-item">
          <a
            href="/logout"
            class="fas fa-sign-out-alt sidebar-icon"
            id="logout-icon"
            data-title="Logout"
          ></a>
          <span class="sidebar-tooltip">Logout</span>
        </div>
      </aside>

      <main class="main-content">
        <div class="carousel-container">
          <div class="carousel" id="carousel1">
            <div class="carousel-inner">
              <div class="carousel-slide">
                <img
                  src="/static/carousel/hospital1.JPG?height=300&width=400"
                  alt="Hospital 1"
                />
              </div>
              <div class="carousel-slide">
                <img
                  src="/static/carousel/hospital2.JPG?height=300&width=400"
                  alt="Hospital 2"
                />
              </div>
              <div class="carousel-slide">
                <img
                  src="/static/carousel/hospital3.JPG?height=300&width=400"
                  alt="Hospital 3"
                />
              </div>
            </div>
            <div class="carousel-buttons"></div>
          </div>
          <div class="carousel" id="carousel2">
            <div class="carousel-inner">
              <div class="carousel-slide">
                <a
                  href="https://www.dabur.com/ayurveda/ayurvedic-medicinal-plants/neem"
                  target="_blank"
                >
                  <img
                    src="/static/carousel/neem.jpg?height=300&width=400"
                    alt="Neem 1"
                  />
                </a>
              </div>
              <div class="carousel-slide">
                <a
                  href="https://www.medicalnewstoday.com/articles/265800"
                  target="_blank"
                >
                  <img
                    src="/static/carousel/aloevera.jpg?height=300&width=400"
                    alt="Aloe Vera"
                  />
                </a>
              </div>
              <div class="carousel-slide">
                <a
                  href="https://www.healthline.com/nutrition/onion-benefits"
                  target="_blank"
                >
                  <img
                    src="/static/carousel/onion.jpg?height=300&width=400"
                    alt="Onion"
                  />
                </a>
              </div>
            </div>
            <div class="carousel-buttons"></div>
          </div>
        </div>

        <div class="map-hospitals-container">
          <div class="map-container">
            <iframe
              src="https://hospital-map.onrender.com"
              allow="geolocation"
              allowfullscreen=""
              width="100%"
              height="100%"
              frameborder="0"
              loading="lazy"
            >
            </iframe>
          </div>
          <div class="hospitals-list" id="hospital-list">
            <h2 class="list-heading">Nearby Hospitals</h2>
            <ul>
              <!-- Hospital items dynamically added here -->
            </ul>
          </div>
        </div>
      </main>

      <!-- Overlay -->
      <div class="overlay" id="overlay"></div>

      <!-- Popup Modal -->
      <div class="popup" id="profile-popup">
        <a
          href="/logout"
          class="fas fa-sign-out-alt logout-icon"
          id="logout-icon"
          data-title="Logout"
        ></a>
        <!-- Logout button -->
        <h2><i class="fas fa-user-circle"></i> Profile</h2>
        <img
          id="profile-image"
          src="/static/profile/placeholder.svg"
          alt="Profile Picture"
        />
        <input type="file" id="profile-image-upload" />
        <div class="input-wrapper">
          <i class="fas fa-user"></i>
          <input
            type="text"
            id="profile-name"
            class="input-field"
            placeholder="Name"
            readonly
          />
        </div>
        <div class="input-wrapper">
          <i class="fas fa-envelope"></i>
          <input
            type="email"
            id="profile-email"
            class="input-field"
            placeholder="Email"
            readonly
          />
        </div>
        <div class="input-wrapper">
          <i class="fas fa-phone"></i>
          <input
            type="text"
            id="profile-phone"
            class="input-field"
            placeholder="Phone"
            readonly
          />
        </div>
        <input type="hidden" id="user-id" />
        <button id="edit-profile"><i class="fas fa-edit"></i> Edit</button>
        <button id="save-profile"><i class="fas fa-save"></i> Save</button>
        <button id="close-profile"><i class="fas fa-times"></i> Close</button>
      </div>

      <aside class="right-sidebar">
        <div class="notification-box" id="notification-box">
          <h3>Notifications</h3>
          <div id="notifications">
            <!-- Notifications dynamically added here -->
          </div>
        </div>

        <div class="waiting-list-box" id="waiting-list-box">
          <h3>Waiting List</h3>
          <div id="waiting-list">
            <!-- Waiting list dynamically added here -->
          </div>
        </div>
  

        <div
          class="action-button book-appointment"
          onclick="handleBookingAction()"
        >
          <i class="fas fa-calendar-plus"></i>
          <span>Book<br />Appointment</span>
        </div>

        <div class="action-button bed-vacancy" onclick="openBedVacancyModal()">
          <i class="fas fa-bed"></i>
          <span>Bed<br />Vacancy</span>
        </div>

        <div
  class="action-button schedule-reminder"
  onclick="openScheduleReminderModal()"
>
  <i class="fas fa-bell"></i>
  <span>Schedule<br />Reminder</span>
</div>
      </aside>
    </div>


    <!-- Chatbot Modal -->
    <div class="chatbot-modal">
      <div class="chatbot-modal-content">
        <span class="chatbot-modal-close">&times;</span>
        <iframe
          width="350"
          height="430"
          allow="microphone;"
          src="https://console.dialogflow.com/api-client/demo/embedded/0c2e4c8f-5612-4ff5-a866-c5dde1d18a33"
        ></iframe>
      </div>
    </div>
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
    <df-messenger
      intent="WELCOME"
      chat-title="AuraBot"
      agent-id="4a6439e5-7eff-49eb-8d86-73d5428d0d25"
      language-code="en"
    ></df-messenger>

    <!-- Modal -->
    <div class="modal" id="bedVacancyModal">
      <div class="modal-content">
        <button class="close" onclick="closeBedModal()">
          <i class="fas fa-times"></i>
        </button>
        <h2><i class="fas fa-bed"></i> Check Bed Availability</h2>
        <form id="bedForm">
          <label for="hospitalName">
            <i class="fas fa-hospital"></i> Search and Select Hospital:
          </label>
          <div class="hospital-dropdown-container">
            <input
              type="text"
              id="hospitalSearch"
              placeholder="Search hospital"
              oninput="filterHospitals()"
            />
            <select id="hospitalName" required>
              <option value="">--Select Hospital--</option>
            </select>
          </div>

          <!-- Bed details section -->
          <div id="bedDetails" style="margin-top: 15px; display: none">
            <h3><i class="fas fa-procedures"></i> Available Beds:</h3>
            <ul id="bedList"></ul>
          </div>

          <!-- Bed Type Selection -->
          <label for="bedType">
            <i class="fas fa-bed"></i> Select Bed Type:
          </label>
          <select id="bedType" required>
            <option value="">--Select Bed Type--</option>
          </select>

          <label for="userName"> <i class="fas fa-user"></i> Your Name: </label>
          <input
            type="text"
            id="userName"
            placeholder="Enter your name"
            required
          />

          <label for="userEmail">
            <i class="fas fa-envelope"></i> Your Email:
          </label>
          <input
            type="email"
            id="userEmail"
            placeholder="Enter your email"
            required
          />

          <button type="submit" style="margin-top: 20px">
            <i class="fas fa-paper-plane"></i> Send Request
          </button>
        </form>
      </div>
    </div>



<!-- Modal for Scheduling Reminder -->
<div id="scheduleReminderModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" onclick="closeScheduleReminderModal()">&times;</span>
    <h2>Schedule Medicine Reminder</h2>
    <form id="scheduleReminderForm">
      <label for="medicineName">Medicine Name:</label>
      <input type="text" id="medicineName" name="medicineName" required />

      <label for="days">Days:</label>
      <select id="days" name="days" multiple required>
        <option value="Monday">Monday</option>
        <option value="Tuesday">Tuesday</option>
        <option value="Wednesday">Wednesday</option>
        <option value="Thursday">Thursday</option>
        <option value="Friday">Friday</option>
        <option value="Saturday">Saturday</option>
        <option value="Sunday">Sunday</option>
      </select>
      <small>Hold Ctrl (Cmd on Mac) to select multiple days.</small>

      <label for="times">Times:</label>
      <input type="time" id="timeInput" name="time" />
      <button type="button" onclick="addTime()">Add Time</button>
      <div id="timeList"></div>

      <label for="phone">Phone Number:</label>
      <input type="tel" id="phone" name="phone" required />

      <button type="button" onclick="scheduleReminder()">Schedule</button>
    </form>
  </div>
</div>


    <!-- Hospital Popup -->
    <div id="hospital-popup" class="popup">
      <h2 id="hospital-name"><i class="fas fa-hospital-symbol"></i></h2>
      <button onclick="showTestSlotForm()">
        <i class="fas fa-vial"></i> Book Test Slot
      </button>
      <button onclick="redirectToDocPage()">
        <i class="fas fa-user-md"></i> Doctor Appointment
      </button>
      <button onclick="closePopup('hospital-popup')">
        <i class="fas fa-times"></i> Close
      </button>
    </div>

    <!-- Test Slot Popup -->
    <div id="test-slot-popup" class="popup">
      <h2>
        <i class="fas fa-calendar-alt"></i> Book Test Slot for
        <span id="hospital-name-display"></span>
      </h2>
      <form id="test-slot-form" onsubmit="submitTestSlot(event)">
        <!-- Test Type Dropdown -->
        <label for="test-type"> <i class="fas fa-flask"></i> Test Type: </label>
        <select id="test-type" required>
          <option disabled selected>Select Test</option>
        </select>

        <!-- Dynamic Test Details -->
        <p id="test-details"></p>

        <!-- Date Dropdown -->
        <label for="test-date">
          <i class="fas fa-calendar-day"></i> Date:
        </label>
        <select id="test-date" required>
          <option disabled selected>Select a date</option>
        </select>

        <!-- Time Dropdown -->
        <label for="test-time"> <i class="fas fa-clock"></i> Time: </label>
        <select id="test-time" required>
          <option disabled selected>Select a time</option>
        </select>

        <!-- Patient Information -->
        <label for="patient-name"> <i class="fas fa-user"></i> Name: </label>
        <input type="text" id="patient-name" required />

        <label for="patient-phone">
          <i class="fas fa-phone-alt"></i> Phone:
        </label>
        <input type="tel" id="patient-phone" required />

        <label for="patient-email">
          <i class="fas fa-envelope"></i> Email:
        </label>
        <input type="email" id="patient-email" required />

        <!-- Prescription Upload -->
        <label for="prescription-pdf">
          <i class="fas fa-file-upload"></i> Upload Prescription:
        </label>
        <input
          type="file"
          id="prescription-pdf"
          accept="application/pdf"
          required
        />

        <!-- Submit Button -->
        <button type="submit"><i class="fas fa-paper-plane"></i> Submit</button>
      </form>
      <button onclick="closePopup('test-slot-popup')">
        <i class="fas fa-times"></i> Close
      </button>
    </div>

    <div id="health-data-popup-health" class="popup">
      <div class="popup-header-health">
        <h2><i class="fa fa-heartbeat"></i> Health Records</h2>
        <button id="close-popup-health">&times;</button>
      </div>
      <div class="tab-menu-health">
        <button
          class="tab-button-health active"
          data-tab="health-data-tab-health"
        >
          <i class="fa fa-database"></i> Health Data
        </button>
        <button class="tab-button-health" data-tab="prescriptions-tab-health">
          <i class="fa fa-file-medical"></i> Prescriptions
        </button>
        <button class="tab-button-health" data-tab="reports-tab-health">
          <i class="fa fa-vials"></i> Test Reports
        </button>
      </div>
      <div id="health-data-tab-health" class="tab-content-health active">
        <section id="health-data-health" class="dashboard-section">
          <div id="health-data-card-health" class="card">
            <div id="no-health-data-health">
              <p>
                <i class="fa fa-info-circle"></i> No health data available.
                Please enter your details to get started.
              </p>
              <button id="enter-health-data-health" class="btn btn-primary">
                <i class="fa fa-edit"></i> Enter Health Data
              </button>
            </div>
            <form id="health-data-form-health" style="display: none">
              <div class="input-group-health">
                <label for="sex-health"
                  ><i class="fa fa-venus-mars"></i> Sex:</label
                >
                <select id="sex-health" class="form-control">
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                </select>
              </div>
              <div class="input-group-health">
                <label for="age-health"
                  ><i class="fa fa-birthday-cake"></i> Age:</label
                >
                <input
                  type="number"
                  id="age-health"
                  class="form-control"
                  required
                />
              </div>
              <div class="input-group-health">
                <label for="height-health"
                  ><i class="fa fa-ruler"></i> Height (cm):</label
                >
                <input
                  type="number"
                  id="height-health"
                  class="form-control"
                  required
                />
              </div>
              <div class="input-group-health">
                <label for="weight-health"
                  ><i class="fa fa-weight"></i> Weight (kg):</label
                >
                <input
                  type="number"
                  id="weight-health"
                  class="form-control"
                  required
                />
              </div>
              <div class="input-group-health">
                <label for="blood-pressure-health"
                  ><i class="fa fa-heart"></i> Blood Pressure(mm/hg):</label
                >
                <input
                  type="text"
                  id="blood-pressure-health"
                  class="form-control"
                  required
                />
              </div>
              <div class="input-group-health">
                <label for="sugar-level-health"
                  ><i class="fa fa-tint"></i> Sugar Level(mg/dL):</label
                >
                <input
                  type="number"
                  id="sugar-level-health"
                  class="form-control"
                  required
                />
              </div>
              <div
                id="period-section-health"
                class="input-group-health"
                style="display: none"
              >
                <label for="last-period-health"
                  ><i class="fa fa-calendar"></i> Last Period Date:</label
                >
                <input
                  type="date"
                  id="last-period-health"
                  class="form-control"
                />
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fa fa-save"></i> Save
              </button>
            </form>
            <div id="health-data-display-health" style="display: none">
              <div class="data-row">
                <i class="fa fa-birthday-cake"></i> Age:
                <span id="display-age-health"></span>
              </div>
              <div class="data-row">
                <i class="fa fa-venus-mars"></i> Sex:
                <span id="display-sex-health"></span>
              </div>
              <div class="data-row">
                <i class="fa fa-ruler"></i> Height:
                <span id="display-height-health"></span>
              </div>
              <div class="data-row">
                <i class="fa fa-weight"></i> Weight:
                <span id="display-weight-health"></span>
              </div>
              <div class="data-row">
                <i class="fa fa-heartbeat"></i> Blood Pressure:
                <span id="display-blood-pressure-health"></span>mmHg
              </div>
              <div id="bp-analysis-health" class="data-row">
                <strong
                  ><i class="fa fa-diagnoses"></i> Blood Pressure
                  Analysis:</strong
                >
                <span id="display-bp-analysis-health"></span>
              </div>
              <div class="data-row">
                <i class="fa fa-tint"></i> Sugar Level:
                <span id="display-sugar-level-health"></span>
              </div>
              <div id="sugar-analysis-health" class="data-row">
                <strong
                  ><i class="fa fa-diagnoses"></i> Sugar Level Analysis:</strong
                >
                <span id="display-sugar-analysis-health"></span>
              </div>
              <div
                id="next-period-health"
                class="data-row"
                style="display: none"
              >
                <i class="fa fa-calendar-alt"></i> Next Period Date:
                <span id="display-next-period-health"></span>
              </div>
              <button id="edit-health-data-health" class="btn btn-primary">
                <i class="fa fa-edit"></i> Edit
              </button>
            </div>
          </div>
        </section>
      </div>
      <div id="prescriptions-tab-health" class="tab-content-health">
        <div class="upload-section-health">
          <label for="upload-prescription-health"
            ><i class="fa fa-upload"></i> Upload Prescription:</label
          >
          <input
            type="file"
            id="upload-prescription-health"
            class="form-control"
          />
          <button id="save-prescription-health" class="btn btn-primary">
            <i class="fa fa-save"></i> Save Prescription
          </button>
          <ul id="prescription-list-health"></ul>
        </div>
      </div>
      <div id="reports-tab-health" class="tab-content-health">
        <div class="upload-section-health">
          <label for="upload-report-health"
            ><i class="fa fa-upload"></i> Upload Test Report:</label
          >
          <input type="file" id="upload-report-health" class="form-control" />
          <button id="save-report-health" class="btn btn-primary">
            <i class="fa fa-save"></i> Save Report
          </button>
          <ul id="report-list-health"></ul>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div id="appointments-tests-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <section id="appointments" class="dashboard-section">
          <h1><i class="fas fa-calendar-check"></i> Appointments</h1>
          <h2><i class="fas fa-clock"></i> Active Appointments</h2>
          <table class="table" id="active-appointments">
            <thead>
              <tr>
                <th><i class="fas fa-calendar-day"></i> Date</th>
                <th><i class="fas fa-user-md"></i> Doctor</th>
                <th><i class="fas fa-hospital"></i> Hospital</th>
                <th><i class="fas fa-tools"></i> Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <h2><i class="fas fa-check-circle"></i> Completed Appointments</h2>
          <table class="table" id="completed-appointments">
            <thead>
              <tr>
                <th><i class="fas fa-calendar-day"></i> Date</th>
                <th><i class="fas fa-user-md"></i> Doctor</th>
                <th><i class="fas fa-hospital"></i> Hospital</th>
                <th><i class="fas fa-prescription-bottle"></i> Prescription</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
        <section id="tests" class="dashboard-section">
          <h1><i class="fas fa-vial"></i> Tests</h1>
          <h2><i class="fas fa-clock"></i> Active Tests</h2>
          <table class="table" id="active-tests">
            <thead>
              <tr>
                <th><i class="fas fa-calendar-day"></i> Date</th>
                <th><i class="fas fa-flask"></i> Test Category</th>
                <th><i class="fas fa-vials"></i> Test Type</th>
                <th><i class="fas fa-tools"></i> Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <h2><i class="fas fa-check-circle"></i> Completed Tests</h2>
          <table class="table" id="completed-tests">
            <thead>
              <tr>
                <th><i class="fas fa-calendar-day"></i> Date</th>
                <th><i class="fas fa-flask"></i> Test Category</th>
                <th><i class="fas fa-vials"></i> Test Type</th>
                <th><i class="fas fa-file-alt"></i> Report</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
      </div>
    </div>

    <!-- Reschedule Modal -->
    <div id="reschedule-modal" class="modal">
      <div class="modal-content">
        <button class="close" onclick="hideModal('reschedule-modal')">
          &times;
        </button>
        <h2><i class="fas fa-calendar-edit"></i> Reschedule Test</h2>
        <form>
          <label for="reschedule-date"
            ><i class="fas fa-calendar"></i> New Date</label
          >
          <select id="reschedule-date">
            <!-- Options will be populated dynamically -->
          </select>

          <label for="reschedule-time"
            ><i class="fas fa-clock"></i> New Time</label
          >
          <select id="reschedule-time">
            <!-- Time options based on selected date -->
          </select>
        </form>
        <button id="reschedule-submit">
          <i class="fas fa-check"></i> Submit
        </button>
      </div>
    </div>

    <!-- Adjust Modal -->
    <div id="adjust-modal" class="modal">
      <div class="modal-content">
        <span
          class="close"
          onclick="document.getElementById('adjust-modal').classList.remove('active')"
          >&times;</span
        >
        <h2><i class="fas fa-calendar-alt"></i> Adjust Appointment</h2>
        <label for="adjust-date"
          ><i class="fas fa-calendar"></i> Select New Date:</label
        >
        <select id="adjust-date"></select>
        <label for="adjust-time"
          ><i class="fas fa-clock"></i> Select New Time:</label
        >
        <select id="adjust-time"></select>
        <button id="adjust-submit" class="btn btn-primary">
          <i class="fas fa-check"></i> Submit
        </button>
      </div>
    </div>

    <!-- Doctor Details Modal -->
    <div id="doctor-details-modal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="hideModal('doctor-details-modal')"
          >&times;</span
        >
        <h2 id="doctor-modal-name">
          <i class="fa-solid fa-user-md"></i>
          <!-- Doctor Icon -->
        </h2>
        <p>
          <strong
            ><i class="fa-solid fa-stethoscope"></i> Specialization:</strong
          >
          <span id="doctor-modal-specialization"></span>
        </p>
        <p>
          <strong><i class="fa-solid fa-hospital"></i> Hospital:</strong>
          <span id="doctor-modal-hospital"></span>
        </p>
        <p>
          <strong><i class="fa-solid fa-money-bill-wave"></i> Fees:</strong>
          <span id="doctor-modal-fees"></span>
        </p>
        <!-- Added Fees -->
        <div id="doctor-modal-description"></div>
        <button id="book-appointment-button">
          <i class="fa-solid fa-calendar-check"></i> Book Appointment
        </button>
      </div>
    </div>

    <!-- Appointment Booking Modal -->
    <div id="appointment-modal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="hideModal('appointment-modal')"
          >&times;</span
        >
        <h2><i class="fa-solid fa-calendar-days"></i> Book Appointment</h2>
        <form id="uniqueAppointmentForm">
          <!-- Doctor Details -->
          <fieldset>
            <legend><i class="fa-solid fa-user-md"></i> Doctor Details</legend>
            <p>
              <strong><i class="fa-solid fa-user-md"></i> Doctor:</strong>
              <span id="uniqueDoctorName"></span>
            </p>
            <p>
              <strong
                ><i class="fa-solid fa-stethoscope"></i> Specialization:</strong
              >
              <span id="uniqueDoctorSpecialization"></span>
            </p>
            <p>
              <strong><i class="fa-solid fa-hospital"></i> Hospital:</strong>
              <span id="uniqueDoctorHospital"></span>
            </p>
          </fieldset>

          <!-- Appointment Details -->
          <fieldset>
            <legend>
              <i class="fa-solid fa-calendar"></i> Appointment Details
            </legend>
            <label for="uniqueAppointmentDate"
              ><i class="fa-solid fa-calendar-day"></i> Select Date:</label
            >
            <select id="uniqueAppointmentDate" required></select>
            <label for="uniqueAppointmentTime"
              ><i class="fa-solid fa-clock"></i> Select Time:</label
            >
            <select id="uniqueAppointmentTime" required></select>
          </fieldset>

          <!-- User Details -->
          <fieldset>
            <legend><i class="fa-solid fa-user"></i> Your Details</legend>
            <label for="uniqueUserName"
              ><i class="fa-solid fa-user"></i> Your Name:</label
            >
            <input
              type="text"
              id="uniqueUserName"
              placeholder="Enter your full name"
              required
            />
            <label for="uniqueUserContact"
              ><i class="fa-solid fa-phone"></i> Contact Number:</label
            >
            <input
              type="tel"
              id="uniqueUserContact"
              placeholder="Enter your phone number"
              required
              pattern="[0-9]{10}"
            />
            <label for="uniqueUserEmail"
              ><i class="fa-solid fa-envelope"></i> Email Address:</label
            >
            <input
              type="email"
              id="uniqueUserEmail"
              placeholder="Enter your email address"
              required
            />
          </fieldset>

          <!-- Form Actions -->
          <div class="form-actions-container">
            <button type="submit">
              <i class="fa-solid fa-check"></i> Confirm
            </button>
            <button
              type="button"
              class="close-btn"
              onclick="hideModal('appointment-modal')"
            >
              <i class="fa-solid fa-times"></i> Close
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      function redirectToHospList() {
        window.location.href = "/hosplist";
      }

      window.addEventListener("load", () => {
        // Retrieve the session data passed from the backend
        const userEmail = "{{ user_email }}";
        const userId = "{{ user_id }}";

        if (userEmail && userId) {
          sessionStorage.setItem("user_email", userEmail);
          sessionStorage.setItem("user_id", userId);
        } else {
          console.error("User email or ID not found in session");
        }
      });

      // Carousel functionality
      class Carousel {
        constructor(element) {
          this.carousel = element;
          this.inner = element.querySelector(".carousel-inner");
          this.slides = element.querySelectorAll(".carousel-slide");
          this.buttonsContainer = element.querySelector(".carousel-buttons");
          this.currentIndex = 0;
          this.slideWidth = 100; // percentage

          this.initButtons();
          this.initAutoPlay();
        }

        initButtons() {
          // Create dots for each slide
          this.slides.forEach((_, index) => {
            const dot = document.createElement("div");
            dot.classList.add("carousel-dot");
            if (index === 0) dot.classList.add("active");
            dot.addEventListener("click", () => this.goToSlide(index));
            this.buttonsContainer.appendChild(dot);
          });
        }

        goToSlide(index) {
          this.currentIndex = index;
          this.inner.style.transform = `translateX(-${
            index * this.slideWidth
          }%)`;

          // Update active dot
          this.buttonsContainer
            .querySelectorAll(".carousel-dot")
            .forEach((dot, i) => {
              dot.classList.toggle("active", i === index);
            });
        }

        nextSlide() {
          this.currentIndex = (this.currentIndex + 1) % this.slides.length;
          this.goToSlide(this.currentIndex);
        }

        initAutoPlay() {
          setInterval(() => this.nextSlide(), 5000);
        }
      }

      // Initialize carousels
      document.querySelectorAll(".carousel").forEach((carousel) => {
        new Carousel(carousel);
      });

      // Hospital list functionality
      document.querySelectorAll(".hospital-item").forEach((item) => {
        item.addEventListener("click", () => {});
      });

      // Action buttons functionality
      document.querySelectorAll(".action-button").forEach((button) => {
        button.addEventListener("click", () => {});
      });

      function getLocationAndPopulateHospitals() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const userLat = position.coords.latitude;
              const userLng = position.coords.longitude;

              console.log(
                "User Location: Latitude =",
                userLat,
                "Longitude =",
                userLng
              );

              // Fetch nearby hospitals
              fetchHospitals(userLat, userLng);
            },
            (error) => {
              console.error("Error fetching user location:", error);
              alert(
                "Unable to retrieve your location. Please check location services."
              );
            }
          );
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      function fetchHospitals(userLat, userLng) {
        console.log("Fetching hospitals for location:", { userLat, userLng });
        fetch(`/get-hospitals?lat=${userLat}&lng=${userLng}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then((hospitals) => {
            console.log("Fetched hospitals:", hospitals);
            const hospitalList = document.getElementById("hospital-list");
            hospitalList.innerHTML = "";

            if (hospitals.length === 0) {
              hospitalList.innerHTML = "<p>No hospitals found nearby</p>";
            } else {
              hospitals.forEach((hospital) => {
                // Create the hospital-item container
                const hospitalItem = document.createElement("div");
                hospitalItem.className = "hospital-item";
                hospitalItem.onclick = () => {
                  showHospitalPopup(hospital.name);
                  populateTestSlots(hospital.name);
                };

                // Create the hospital-icon
                const hospitalIcon = document.createElement("div");
                hospitalIcon.className = "hospital-icon";
                hospitalIcon.innerHTML = "üè•"; // You can customize the icon here

                // Create the hospital-info container
                const hospitalInfo = document.createElement("div");
                hospitalInfo.className = "hospital-info";

                // Add hospital name
                const hospitalName = document.createElement("h3");
                hospitalName.innerText = hospital.name;

                // Add hospital details (if any)
                const hospitalDetails = document.createElement("p");
                hospitalDetails.innerText = hospital.details || "";

                // Append elements
                hospitalInfo.appendChild(hospitalName);
                hospitalInfo.appendChild(hospitalDetails);

                hospitalItem.appendChild(hospitalIcon);
                hospitalItem.appendChild(hospitalInfo);

                hospitalList.appendChild(hospitalItem);
              });
            }
          })
          .catch((error) => {
            console.error("Error fetching hospitals:", error);
            alert(
              "An error occurred while fetching hospitals. Please try again later."
            );
          });
      }

      function populateTestSlots(hospitalName) {
        console.log("Populating test slots for hospital:", hospitalName);
        fetch(`/get-tests?hospital=${hospitalName}`)
          .then((response) => response.json())
          .then((data) => {
            console.log("Fetched test data:", data);

            const testTypeDropdown = document.getElementById("test-type");
            const testDetails = document.getElementById("test-details");
            const dateDropdown = document.getElementById("test-date");
            const timeDropdown = document.getElementById("test-time");

            // Clear dropdowns
            testTypeDropdown.innerHTML =
              "<option disabled selected>Search and select a test type</option>";
            dateDropdown.innerHTML = "";
            timeDropdown.innerHTML = "";
            testDetails.innerHTML = "";

            // Flatten test availability data for easy search and display
            const allTests = [];
            for (const [category, tests] of Object.entries(data.tests)) {
              for (const [testType, testData] of Object.entries(tests)) {
                allTests.push({
                  category,
                  testType,
                  price: testData.price,
                  availability: testData,
                });
              }
            }

            // Populate test type dropdown
            allTests.forEach((test) => {
              const option = document.createElement("option");
              option.value = JSON.stringify(test); // Pass the full test data
              option.innerText = `${test.testType} (‚Çπ${test.price})`;
              testTypeDropdown.appendChild(option);
            });

            // Update available dates and times when a test type is selected
            testTypeDropdown.addEventListener("change", () => {
              const selectedTest = JSON.parse(testTypeDropdown.value); // Parse the selected test data
              const availability = selectedTest.availability;

              // Display price
              testDetails.innerText = `Selected Test: ${selectedTest.testType}\nPrice: ‚Çπ${selectedTest.price}`;

              // Populate dates and times
              dateDropdown.innerHTML = "";
              timeDropdown.innerHTML = "";

              const dates = Object.keys(availability).filter(
                (key) => key !== "price"
              );
              if (dates.length === 0) {
                dateDropdown.innerHTML =
                  "<option disabled>No dates available</option>";
                return;
              }

              dates.forEach((date) => {
                const dateOption = document.createElement("option");
                dateOption.value = date;
                dateOption.innerText = date;
                dateDropdown.appendChild(dateOption);
              });

              const updateTimeDropdown = (selectedDate) => {
                timeDropdown.innerHTML = "";
                const timeSlots = availability[selectedDate];

                if (timeSlots) {
                  Object.entries(timeSlots).forEach(([time, slotInfo]) => {
                    if (slotInfo.slots > 0) {
                      const timeOption = document.createElement("option");
                      timeOption.value = time;
                      timeOption.innerText = `${time} (Available Slots: ${slotInfo.slots})`;
                      timeDropdown.appendChild(timeOption);
                    }
                  });
                } else {
                  timeDropdown.innerHTML =
                    "<option disabled>No times available</option>";
                }
              };

              updateTimeDropdown(dates[0]); // Default to the first date
              dateDropdown.addEventListener("change", () =>
                updateTimeDropdown(dateDropdown.value)
              );
            });
          })
          .catch((error) => {
            console.error("Error fetching test data:", error);
            alert("Unable to fetch test data. Please try again later.");
          });
      }
      function submitTestSlot(event) {
        event.preventDefault();
        console.log("Submitting test slot booking...");

        const hospitalName = document
          .getElementById("hospital-name-display")
          .innerText.trim();
        const selectedTestData = JSON.parse(
          document.getElementById("test-type").value
        );
        const testCategory = selectedTestData.category;
        const testType = selectedTestData.testType;
        const testDate = document.getElementById("test-date").value.trim();
        const testTime = document.getElementById("test-time").value.trim();
        const patientName = document
          .getElementById("patient-name")
          .value.trim();
        const patientPhone = document
          .getElementById("patient-phone")
          .value.trim();
        const patientEmail = document
          .getElementById("patient-email")
          .value.trim();
        const prescriptionFile =
          document.getElementById("prescription-pdf").files[0];

        if (!prescriptionFile) {
          alert("Please upload a prescription PDF.");
          return;
        }

        if (!hospitalName) {
          alert(
            "Hospital name is missing. Please refresh the page or contact support."
          );
          return;
        }

        const formData = new FormData();
        formData.append("hospital_name", hospitalName);
        formData.append("test_category", testCategory);
        formData.append("test_type", testType);
        formData.append("test_date", testDate);
        formData.append("test_time", testTime);
        formData.append("patient_name", patientName);
        formData.append("patient_phone", patientPhone);
        formData.append("patient_email", patientEmail);
        formData.append("prescription_pdf", prescriptionFile);

        fetch("/book-test", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Response from booking API:", data);
            if (data.error) {
              alert(`Error: ${data.error}`);
            } else {
              alert(
                `Test Slot Registered Successfully!\nSlot Code: ${data.test_slot_code}`
              );
              closePopup("test-slot-popup");
            }
          })
          .catch((error) => {
            console.error("Error booking test slot:", error);
            alert(
              "An error occurred while booking the test slot. Please try again later."
            );
          });
      }
      function showHospitalPopup(hospitalName) {
        console.log("Displaying popup for hospital:", hospitalName);
        // Set the hospital name in the popup
        document.getElementById("hospital-name").innerText = hospitalName;
        // Display the popup
        document.getElementById("hospital-popup").style.display = "block";
      }
      
      function redirectToDocPage() {
        // Retrieve the text content of the hospital name element
        const hospitalName = document.getElementById("hospital-name").innerText; 
        console.log("Redirecting to doctor page for hospital:", hospitalName);
      
        // Redirect to the /doclist route with the hospital name as a query parameter
        window.location.href = `/doclist?hospital=${encodeURIComponent(hospitalName)}`;
      }
      

      function showTestSlotForm() {
        console.log("Switching to test slot form...");
        closePopup("hospital-popup");
        document.getElementById("test-slot-popup").style.display = "block";
      }

      function closePopup(popupId) {
        console.log(`Closing popup: ${popupId}`);
        document.getElementById(popupId).style.display = "none";
      }

     

      // Initialize the process
      getLocationAndPopulateHospitals();

      window.onload = function () {
        console.log("Window fully loaded.");

        const profileButton = document.getElementById("profile-button");
        const profilePopup = document.getElementById("profile-popup");
        const overlay = document.getElementById("overlay");
        const closeProfileButton = document.getElementById("close-profile");

        // Show popup modal
        profileButton.addEventListener("click", () => {
          console.log("Profile button clicked");
          profilePopup.style.display = "block";
          overlay.style.display = "block";
        });

        // Close popup modal
        closeProfileButton.addEventListener("click", () => {
          console.log("Close profile button clicked");
          profilePopup.style.display = "none";
          overlay.style.display = "none";
        });

        overlay.addEventListener("click", () => {
          console.log("Overlay clicked");
          profilePopup.style.display = "none";
          overlay.style.display = "none";
        });

        // Profile Management
        const profileImage = document.getElementById("profile-image");
        const saveProfileBtn = document.getElementById("save-profile");
        const editProfileBtn = document.getElementById("edit-profile");
        const profileImageUpload = document.getElementById(
          "profile-image-upload"
        );
        const profileName = document.getElementById("profile-name");
        const profileEmail = document.getElementById("profile-email");
        const profilePhone = document.getElementById("profile-phone");
        const userIdInput = document.getElementById("user-id");

        // Function to toggle between edit and view mode
        function toggleEditMode(editable) {
          console.log(`Toggling edit mode: ${editable}`);
          profileName.readOnly = !editable;
          profileEmail.readOnly = !editable;
          profilePhone.readOnly = !editable;
          profileImageUpload.style.display = editable ? "block" : "none";
          saveProfileBtn.style.display = editable ? "block" : "none";
          editProfileBtn.style.display = editable ? "none" : "block";
        }

        // Function to fetch user profile data
        async function fetchProfile() {
          console.log("Fetching profile data...");
          try {
            const response = await fetch(
              "/dashboard/profile"
            );
            console.log("Response Status:", response.status);
            const user = await response.json();
            console.log("Profile data fetched:", user);

            if (response.ok) {
              profileName.value = user.name || "";
              profileEmail.value = user.email || "";
              profilePhone.value = user.phone_number || "";
              profileImage.src =
                user.profile_picture || "/static/profile/placeholder.svg";
              userIdInput.value = user.user_id;
            } else {
              console.error(
                "Error loading profile:",
                user.error || "Failed to load profile."
              );
              alert(user.error || "Failed to load profile.");
            }
          } catch (error) {
            console.error("Error fetching profile:", error);
          }
        }

        // Function to save updated profile
        async function saveProfile() {
          console.log("Saving profile...");
          const userId = userIdInput.value;
          if (!userId) {
            alert("User ID is missing.");
            return;
          }

          const formData = new FormData();
          formData.append("name", profileName.value);
          formData.append("email", profileEmail.value);
          formData.append("phone", profilePhone.value);
          if (profileImageUpload.files[0]) {
            formData.append("profile_picture", profileImageUpload.files[0]);
          }

          try {
            const response = await fetch(`/dashboard/profile/${userId}`, {
              method: "POST",
              body: formData,
            });

            const result = await response.json();
            console.log("Profile save result:", result);
            if (response.ok) {
              alert(result.message || "Profile updated successfully!");
              toggleEditMode(false);
            } else {
              alert(result.error || "Error updating profile.");
            }
          } catch (error) {
            console.error("Error saving profile:", error);
          }
        }

        // Event listeners for profile actions
        editProfileBtn.addEventListener("click", () => {
          console.log("Edit profile button clicked");
          toggleEditMode(true);
        });
        saveProfileBtn.addEventListener("click", saveProfile);
        profileImageUpload.addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => (profileImage.src = e.target.result);
            reader.readAsDataURL(file);
          }
        });

        // Fetch the profile data first when the page loads
        fetchProfile();

        // Modal elements
        const modal = document.getElementById("appointments-tests-modal");
        const openModalBtn = document.getElementById("open-modal"); // Ensure this button exists in your HTML
        const closeModalBtn = modal.querySelector(".close"); // Close button within modal

        if (modal && openModalBtn && closeModalBtn) {
          // Open modal on button click
          openModalBtn.addEventListener("click", () => {
            console.log("Open modal button clicked.");
            modal.classList.add("active");
          });

          // Close modal on button click
          closeModalBtn.addEventListener("click", () => {
            console.log("Close modal button clicked.");
            modal.classList.remove("active");
          });
        } else {
          console.error(
            "Modal, open button, or close button not found in DOM."
          );
        }

        // Optional: Close modal when clicking outside the content
        window.addEventListener("click", (event) => {
          if (event.target === modal) {
            console.log("Clicked outside modal, closing.");
            modal.classList.remove("active");
          }
        });

        // Fetch and populate appointments
        async function fetchAppointments() {
          console.log("[fetchAppointments] Function called.");
          const userEmail = sessionStorage.getItem("user_email");
          console.log(userEmail);

          if (!userEmail) {
            console.warn(
              "[fetchAppointments] User email missing. Redirecting to login."
            );
            alert("User not logged in or email not found in session.");
            window.location.href = "/login";
            return;
          }

          try {
            const response = await fetch(
              `/dashboard/getUserAppointments?email=${encodeURIComponent(
                userEmail
              )}`
            );
            const data = await response.json();

            if (response.ok) {
              populateAppointments(data);
            } else {
              alert(data.message || "Failed to fetch appointments.");
            }
          } catch (error) {
            console.error("[fetchAppointments] Error:", error);
          }
        }

        function populateAppointments(data) {
          const activeAppointments = data.active || [];
          const completedAppointments = data.completed || [];
          const activeTableBody = document.querySelector(
            "#active-appointments tbody"
          );
          const completedTableBody = document.querySelector(
            "#completed-appointments tbody"
          );

          if (!activeTableBody || !completedTableBody) {
            console.error("[populateAppointments] Table bodies not found.");
            return;
          }

          activeAppointments.forEach((appointment) => {
            activeTableBody.insertAdjacentHTML(
              "beforeend",
              `
                    <tr>
                        <td>${new Date(
                          appointment.date_time
                        ).toLocaleString()}</td>
                        <td>${appointment.doctor_name}</td> <!-- Doctor Name -->
                        <td>${
                          appointment.doctor_hospital
                        }</td> <!-- Added Hospital -->
                        <td>
                            <button class="btn btn-danger btn-sm cancel" data-id="${
                              appointment.appointment_id
                            }" data-date-time="${
                appointment.date_time
              }">Cancel</button>
                            <button class="btn btn-warning btn-sm adjust" data-id="${
                              appointment.appointment_id
                            }" data-doctor="${
                appointment.doctor_name
              }" data-date-time="${appointment.date_time}">Adjust</button>
                        </td>
                    </tr>
                `
            );
          });

          completedAppointments.forEach((appointment) => {
            const prescription = appointment.prescription
              ? `<a href="${appointment.prescription}" target="_blank">View Prescription</a>`
              : "Prescription not provided";
            completedTableBody.insertAdjacentHTML(
              "beforeend",
              `
                    <tr>
                        <td>${new Date(
                          appointment.date_time
                        ).toLocaleString()}</td>
                        <td>${
                          appointment.doctor_name
                        }</td> <!-- Updated to doctor_name -->
                        <td>${
                          appointment.doctor_hospital
                        }</td> <!-- Added Hospital -->
                        <td>${prescription}</td>
                    </tr>
                `
            );
          });
        }

        // Fetch and populate tests
        async function fetchTests() {
          console.log("[fetchTests] Function called.");
          const userEmail = sessionStorage.getItem("user_email");

          if (!userEmail) {
            console.warn(
              "[fetchTests] User email missing. Redirecting to login."
            );
            alert("User not logged in or email not found in session.");
            window.location.href = "/login";
            return;
          }

          try {
            const response = await fetch(
              `/dashboard/getUserTests?email=${encodeURIComponent(userEmail)}`
            );
            const data = await response.json();

            if (response.ok) {
              populateTests(data);
            } else {
              alert("Failed to fetch tests.");
            }
          } catch (error) {
            console.error("[fetchTests] Error:", error);
          }
        }

        function populateTests(data) {
          const activeTests = data.active || [];
          const completedTests = data.completed || [];
          const activeTableBody = document.querySelector("#active-tests tbody");
          const completedTableBody = document.querySelector(
            "#completed-tests tbody"
          );

          if (!activeTableBody || !completedTableBody) {
            console.error("[populateTests] Table bodies not found.");
            return;
          }

          activeTests.forEach((test) => {
            activeTableBody.insertAdjacentHTML(
              "beforeend",
              `
                    <tr>
                        <td>${test.test_date} ${test.test_time}</td>
                        <td>${test.test_category}</td>
                        <td>${test.test_type}</td>
                        <td>
                            <button class="btn btn-danger btn-sm cancel" data-slot-code="${test.test_slot_code}">Cancel</button>
                            <button class="btn btn-warning btn-sm reschedule" data-slot-code="${test.test_slot_code}" data-date="${test.test_date}" data-time="${test.test_time}">Reschedule</button>
                        </td>
                    </tr>
                `
            );
          });

          completedTests.forEach((test) => {
            const report = test.report
              ? `<a href="${test.report}" target="_blank">View Report</a>`
              : "Report not available";
            completedTableBody.insertAdjacentHTML(
              "beforeend",
              `
                    <tr>
                        <td>${test.test_date} ${test.test_time}</td>
                        <td>${test.test_category}</td>
                        <td>${test.test_type}</td>
                        <td>${report}</td>
                    </tr>
                `
            );
          });
        }

        // Event delegation for cancel, reschedule, and adjust buttons
        document.addEventListener("click", function (event) {
          if (event.target.classList.contains("cancel")) {
            handleCancel(event.target);
          } else if (event.target.classList.contains("reschedule")) {
            console.log("Reschedule button clicked.");
            handleReschedule(event.target);
          } else if (event.target.classList.contains("adjust")) {
            console.log("Adjust button clicked.");
            handleAdjust(event.target);
          }
        });

        async function handleCancel(target) {
          const slotCode =
            target.getAttribute("data-slot-code") ||
            target.getAttribute("data-date-time");
          const userEmail = sessionStorage.getItem("user_email");

          if (!slotCode || !userEmail) {
            alert("Missing slot code or user email.");
            return;
          }

          const confirmCancel = confirm("Are you sure you want to cancel?");
          if (!confirmCancel) return;

          try {
            const response = await fetch(
              `/dashboard/cancel?email=${encodeURIComponent(
                userEmail
              )}&slot=${encodeURIComponent(slotCode)}`,
              {
                method: "DELETE",
              }
            );

            if (response.ok) {
              alert("Successfully cancelled.");
              location.reload();
            } else {
              alert("Failed to cancel.");
            }
          } catch (error) {
            console.error("Error canceling:", error);
          }
        }

        async function handleReschedule(target) {
          const testSlotCode = target.getAttribute("data-slot-code");
          const oldDate = target.getAttribute("data-date");
          const oldTime = target.getAttribute("data-time");
          const userEmail = sessionStorage.getItem("user_email");

          console.log(
            "Reschedule button clicked for test slot:",
            testSlotCode,
            "Old Date/Time:",
            oldDate,
            oldTime,
            "Email:",
            userEmail
          );

          // Show modal
          const modal = document.getElementById("reschedule-modal");
          modal.classList.add("active");

          // Populate the modal with current values
          document.getElementById("reschedule-date").value = oldDate;
          document.getElementById("reschedule-time").value = oldTime;

          // Fetch available slots
          const availableSlots = await fetchAvailableSlotsForRescheduling(
            testSlotCode
          );

          if (!availableSlots || Object.keys(availableSlots).length === 0) {
            alert("No available slots for rescheduling.");
            return;
          }

          // Populate the date dropdown
          const dateDropdown = document.getElementById("reschedule-date");
          const timeDropdown = document.getElementById("reschedule-time");
          dateDropdown.innerHTML = ""; // Clear existing options
          timeDropdown.innerHTML = ""; // Clear existing options

          Object.keys(availableSlots).forEach((date) => {
            const option = document.createElement("option");
            option.value = date;
            option.textContent = date;
            dateDropdown.appendChild(option);
          });

          // Populate the time dropdown based on the initially selected date
          const populateTimeDropdown = (selectedDate) => {
            timeDropdown.innerHTML = ""; // Clear existing options
            if (availableSlots[selectedDate]) {
              Object.keys(availableSlots[selectedDate]).forEach((time) => {
                const option = document.createElement("option");
                option.value = time;
                option.textContent = `${time} (${availableSlots[selectedDate][time]} slots available)`;
                timeDropdown.appendChild(option);
              });
            }
          };

          // Attach onchange event to the date dropdown
          dateDropdown.onchange = () => {
            const selectedDate = dateDropdown.value;
            populateTimeDropdown(selectedDate);
          };

          // Trigger the initial population of time dropdown
          populateTimeDropdown(Object.keys(availableSlots)[0]);

          // Add event listener for reschedule submission
          const submitBtn = document.getElementById("reschedule-submit");
          submitBtn.onclick = async () => {
            const newDate = document.getElementById("reschedule-date").value;
            const newTime = document.getElementById("reschedule-time").value;

            if (newDate && newTime && userEmail) {
              try {

                // Debug statement to log the data being sent
      const requestData = {
        email: userEmail,
        oldSlot: testSlotCode,
        newDate,
        newTime,
      };
      console.log("Data sent to backend for rescheduling:", requestData);



                const response = await fetch(
                  "/dashboard/rescheduleTest",
                  {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                      email: userEmail,
                      oldSlot: testSlotCode,
                      newDate,
                      newTime,
                    }),
                  }
                );

                if (!response.ok) {
                  const errorData = await response.json();
                  alert(errorData.error || "Failed to reschedule the test.");
                  return;
                }

                alert("Test rescheduled successfully.");
                location.reload();
              } catch (error) {
                console.error("Error rescheduling test:", error);
                alert("There was an error rescheduling the test.");
              }
            } else {
              alert("Invalid input for rescheduling test.");
            }
          };
        }

        async function fetchAvailableSlotsForRescheduling(testSlotCode) {
          try {
            // Fetch data from the server
            const response = await fetch(
              `/dashboard/getAvailableSlotsForRescheduling?testSlotCode=${encodeURIComponent(
                testSlotCode
              )}`
            );

            // Handle HTTP errors
            if (!response.ok) {
              const errorData = await response.json(); // Attempt to parse error response as JSON
              console.error(
                "Error fetching available slots:",
                errorData.error || "Unknown error"
              );
              alert(errorData.error || "Failed to fetch available slots.");
              return {}; // Return an empty object on failure
            }

            // Parse the response as JSON
            const data = await response.json();

            // Ensure the response contains the expected structure
            if (
              !data.available_slots ||
              typeof data.available_slots !== "object"
            ) {
              console.error("Unexpected response structure:", data);
              alert("Error: Invalid slot data received.");
              return {}; // Return an empty object on failure
            }

            console.log("Fetched available slots:", data.available_slots);
            return data.available_slots; // Return only the available slots
          } catch (error) {
            // Handle network or parsing errors
            console.error("Error fetching available slots:", error);
            alert("Error fetching available slots. Please try again.");
            return {}; // Return an empty object in case of an error
          }
        }

        async function handleAdjust(target) {
          const doctorName = target.getAttribute("data-doctor");
          const appointmentDateTime = target.getAttribute("data-date-time");
          const userEmail = sessionStorage.getItem("user_email");

          console.log(
            "Adjust button clicked for appointment:",
            appointmentDateTime,
            "Doctor:",
            doctorName,
            "Email:",
            userEmail
          );

          if (!userEmail || !doctorName || !appointmentDateTime) {
            alert("Missing user email, doctor name, or appointment date/time.");
            return;
          }

          try {
            // Fetch doctor availability
            const response = await fetch(
              `/dashboard/getDoctorAvailability?doc_name=${encodeURIComponent(
                doctorName
              )}`
            );
            console.log(
              "Get doctor availability response status:",
              response.status
            );

            if (!response.ok) {
              alert("Failed to fetch doctor availability.");
              return;
            }

            const slots = await response.json();
            console.log("Available slots for doctor:", slots);

            // Populate modal dropdowns
            const dateDropdown = document.getElementById("adjust-date");
            const timeDropdown = document.getElementById("adjust-time");

            dateDropdown.innerHTML = "";
            timeDropdown.innerHTML =
              '<option value="" disabled selected>Select a time</option>'; // Default time option

            Object.keys(slots).forEach((date) => {
              const option = document.createElement("option");
              option.value = date;
              option.textContent = date;
              dateDropdown.appendChild(option);
            });

            // Update time options on date change
            dateDropdown.onchange = () => {
              const selectedDate = dateDropdown.value;
              timeDropdown.innerHTML =
                '<option value="" disabled selected>Select a time</option>'; // Reset time dropdown
              if (slots[selectedDate]) {
                Object.keys(slots[selectedDate]).forEach((time) => {
                  const option = document.createElement("option");
                  option.value = time;
                  option.textContent = `${time} (${slots[selectedDate][time]} slots available)`;
                  timeDropdown.appendChild(option);
                });
              }
            };

            // Trigger initial load of times
            dateDropdown.dispatchEvent(new Event("change"));

            // Show modal
            const modal = document.getElementById("adjust-modal");
            modal.classList.add("active");

            // Handle submit
            const submitBtn = document.getElementById("adjust-submit");
            submitBtn.onclick = async () => {
              const newDate = dateDropdown.value;
              const newTime = timeDropdown.value;

              if (!newDate || !newTime) {
                alert("Please select both date and time.");
                return;
              }

              const newSlot = `${newDate}T${newTime}`;
              try {
                const adjustResponse = await fetch(
                  `/dashboard/adjustAppointment`,
                  {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                      email: userEmail,
                      oldSlot: appointmentDateTime,
                      newSlot,
                    }),
                  }
                );
                console.log(
                  "Adjust appointment response status:",
                  adjustResponse.status
                );

                if (adjustResponse.ok) {
                  alert("Appointment rescheduled successfully.");
                  location.reload();
                } else {
                  alert("Failed to reschedule the appointment.");
                }
              } catch (error) {
                console.error("Error adjusting appointment:", error);
                alert("An error occurred while rescheduling the appointment.");
              }
            };
          } catch (error) {
            console.error("Error fetching doctor availability:", error);
            alert("An error occurred while fetching doctor availability.");
          }
        }

        window.onclick = function (event) {
          const modal = document.getElementById("reschedule-modal");
          if (event.target === modal) {
            modal.classList.remove("active");
          }
        };

        console.log("Initializing data fetch...");
        fetchAppointments();
        fetchTests();

        // Fetch reminders and populate the notifications box
        async function fetchNotifications() {
          try {
            const userEmail = sessionStorage.getItem("user_email");
            if (!userEmail) {
              console.error("User email not found in sessionStorage");
              return;
            }

            const response = await fetch("/api/fetch_notifications", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email: userEmail }),
            });

            const notifications = await response.json();
            const notificationsDiv = document.getElementById("notifications");
            notificationsDiv.innerHTML = ""; // Clear current notifications

            if (notifications.length === 0) {
              notificationsDiv.innerHTML = "<p>No new notifications.</p>";
              return;
            }

            notifications.forEach((message, index) => {
              const notificationItem = document.createElement("div");
              notificationItem.classList.add("notification-item");
              notificationItem.innerHTML = `
                <p>${message}</p>
                <button onclick="markAsRead(${index})">Read</button>
            `;
              notificationsDiv.appendChild(notificationItem);
            });
          } catch (error) {
            console.error("Error fetching notifications:", error);
          }
        }

        // Mark a notification as read
        async function markAsRead(index) {
          try {
            const userEmail = sessionStorage.getItem("user_email");
            if (!userEmail) {
              console.error("User email not found in sessionStorage");
              return;
            }

            const response = await fetch("/api/mark_notification_as_read", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email: userEmail, index }),
            });

            if (response.ok) {
              fetchNotifications(); // Refresh notifications
            } else {
              console.error("Failed to mark notification as read");
            }
          } catch (error) {
            console.error("Error marking notification as read:", error);
          }
        }

        // Make globally accessible
        window.markAsRead = markAsRead;

        // Initial fetch
        fetchNotifications();

        // User email from sessionStorage
        const userEmail = sessionStorage.getItem("user_email");

        if (!userEmail) {
          alert("User email is not available. Please log in.");
          return;
        }

        // Open health data popup when the health data button is clicked
        const healthDataButton = document.getElementById("health-data-button");
        if (healthDataButton) {
          healthDataButton.addEventListener("click", () => {
            const popup = document.getElementById("health-data-popup-health");
            if (popup) {
              popup.style.display = "block";
            } else {
              console.error("Popup element not found.");
            }
          });
        }

        console.log("User Email from sessionStorage:", userEmail);

        // Tab buttons and content handling
        const tabButtons = document.querySelectorAll(".tab-button-health");
        const tabContents = document.querySelectorAll(".tab-content-health");
        const popupCloseButton = document.getElementById("close-popup-health");

        if (tabButtons.length > 0) {
          tabButtons.forEach((button) =>
            button.addEventListener("click", () => {
              tabButtons.forEach((btn) => btn.classList.remove("active"));
              tabContents.forEach((content) =>
                content.classList.remove("active")
              );

              button.classList.add("active");
              document
                .getElementById(button.dataset.tab)
                .classList.add("active");
            })
          );
        }

        if (popupCloseButton) {
          popupCloseButton.addEventListener("click", () => {
            document.getElementById("health-data-popup-health").style.display =
              "none";
          });
        }

        // Health Data Management
        const noHealthDataSection = document.getElementById(
          "no-health-data-health"
        );
        const healthDataForm = document.getElementById(
          "health-data-form-health"
        );
        const healthDataDisplay = document.getElementById(
          "health-data-display-health"
        );
        const enterHealthDataButton = document.getElementById(
          "enter-health-data-health"
        );
        const editHealthDataButton = document.getElementById(
          "edit-health-data-health"
        );
        const sexDropdown = document.getElementById("sex-health");
        const periodSection = document.getElementById("period-section-health");
        const lastPeriodInput = document.getElementById("last-period-health");
        const nextPeriodSection = document.getElementById("next-period-health");
        const displayNextPeriod = document.getElementById(
          "display-next-period-health"
        );

        let healthData = null;

        function togglePeriodSection() {
          periodSection.style.display =
            sexDropdown.value === "female" ? "block" : "none";
        }

        function calculateNextPeriod(lastPeriodDate) {
          if (!lastPeriodDate)
            return { nextPeriod: "", phase: "", phaseInfo: "" };

          const currentDate = new Date();
          const lastDate = new Date(lastPeriodDate);
          const daysSinceLastPeriod = Math.floor(
            (currentDate - lastDate) / (1000 * 60 * 60 * 24)
          );

          let phase = "";
          let phaseInfo = "";

          // Determine the menstrual phase based on days since the last period
          if (daysSinceLastPeriod >= 0 && daysSinceLastPeriod <= 5) {
            phase = "Menstrual Phase";
            phaseInfo =
              "Shedding of the uterine lining occurs, resulting in menstrual bleeding. Hormones: Low levels of estrogen and progesterone.";
          } else if (daysSinceLastPeriod >= 6 && daysSinceLastPeriod <= 13) {
            phase = "Follicular Phase";
            phaseInfo =
              "The uterine lining begins to thicken in preparation for possible pregnancy. Hormones: Rising levels of estrogen.";
          } else if (daysSinceLastPeriod === 14) {
            phase = "Ovulation Phase";
            phaseInfo =
              "A mature egg is released, and it may be fertilized by sperm. Hormones: High levels of LH and estrogen.";
          } else if (daysSinceLastPeriod >= 15 && daysSinceLastPeriod <= 28) {
            phase = "Luteal Phase";
            phaseInfo =
              "The corpus luteum secretes progesterone to maintain the uterine lining. Hormones: High progesterone levels (early phase).";
          } else {
            phase = "Unknown Phase";
            phaseInfo = "Phase could not be determined. Check the input date.";
          }

          const nextPeriodDate = new Date(lastPeriodDate);
          nextPeriodDate.setDate(nextPeriodDate.getDate() + 28); // Approximate next period date

          return {
            nextPeriod: nextPeriodDate.toISOString().split("T")[0],
            phase,
            phaseInfo,
          };
        }

        function analyzeHealthData(data) {
          let bpAnalysis = "";
          const [systolic, diastolic] = data.bloodPressure
            .split("/")
            .map(Number);

          // BP analysis based on the general range and age group
          const age = data.age; // Age will be part of the data
          bpAnalysis = getBpAnalysis(age, systolic, diastolic);

          let sugarAnalysis = "";
          const fastingSugar = data.sugarLevel; // Fasting sugar level
          const postMealSugar = data.postMealSugarLevel; // Optional post-meal sugar level
          const hbA1c = data.hbA1c; // Optional HbA1c level

          // Sugar analysis based on fasting, post-meal, and HbA1c levels
          sugarAnalysis = getSugarAnalysis(fastingSugar, postMealSugar, hbA1c);

          return { bpAnalysis, sugarAnalysis };
        }

        // Helper function to analyze BP based on age group
        function getBpAnalysis(age, systolic, diastolic) {
          let range = {};

          // Define ideal ranges for different age groups using if conditions
          if (age >= 20 && age <= 29) {
            range = { minSys: 116, maxSys: 120, minDia: 76, maxDia: 80 };
          } else if (age >= 30 && age <= 39) {
            range = { minSys: 120, maxSys: 124, minDia: 80, maxDia: 84 };
          } else if (age >= 40 && age <= 49) {
            range = { minSys: 124, maxSys: 130, minDia: 84, maxDia: 86 };
          } else if (age >= 50 && age <= 59) {
            range = { minSys: 130, maxSys: 134, minDia: 86, maxDia: 88 };
          } else if (age >= 60) {
            range = { minSys: 134, maxSys: 139, minDia: 88, maxDia: 90 };
          }

          // BP analysis
          if (systolic < range.minSys && diastolic < range.minDia) {
            return "Low BP, consider consulting a doctor.";
          } else if (systolic <= range.maxSys && diastolic <= range.maxDia) {
            return "Ideal BP for your age.";
          } else {
            return "High BP, consider monitoring or consulting a doctor.";
          }
        }

        // Helper function to analyze sugar levels based on Fasting, Post-Meal, and HbA1c
        function getSugarAnalysis(fastingSugar, postMealSugar, hbA1c) {
          let sugarAnalysis = "";

          // Fasting Blood Sugar Analysis
          if (fastingSugar < 100) {
            sugarAnalysis = "Normal fasting blood sugar.";
          } else if (fastingSugar >= 100 && fastingSugar <= 125) {
            sugarAnalysis =
              "Prediabetes - Fasting Blood Sugar (FBS) is higher than normal.";
          } else {
            sugarAnalysis = "Diabetes - Fasting Blood Sugar (FBS) is too high.";
          }

          // Post-Meal Sugar Analysis (if available)
          if (postMealSugar !== undefined) {
            if (postMealSugar < 140) {
              sugarAnalysis += " Normal post-meal blood sugar.";
            } else if (postMealSugar >= 140 && postMealSugar <= 199) {
              sugarAnalysis +=
                " Prediabetes - Post-meal blood sugar is higher than normal.";
            } else {
              sugarAnalysis += " Diabetes - Post-meal blood sugar is too high.";
            }
          }

          // HbA1c Analysis (if available)
          if (hbA1c !== undefined) {
            if (hbA1c < 5.7) {
              sugarAnalysis += " Normal HbA1c.";
            } else if (hbA1c >= 5.7 && hbA1c <= 6.4) {
              sugarAnalysis += " Prediabetes - HbA1c is higher than normal.";
            } else {
              sugarAnalysis += " Diabetes - HbA1c is too high.";
            }
          }

          return sugarAnalysis;
        }

        function showForm(data = null) {
          noHealthDataSection.style.display = "none";
          healthDataDisplay.style.display = "none";
          healthDataForm.style.display = "block";

          if (data) {
            document.getElementById("sex-health").value = data.sex;
            document.getElementById("height-health").value = data.height;
            document.getElementById("weight-health").value = data.weight;
            document.getElementById("blood-pressure-health").value =
              data.bloodPressure;
            document.getElementById("sugar-level-health").value =
              data.sugarLevel;
            document.getElementById("last-period-health").value =
              data.lastPeriod || "";
            togglePeriodSection();
          }
        }

        function showData(data) {
          console.log("Displaying Health Data:", data);
          noHealthDataSection.style.display = "none";
          healthDataForm.style.display = "none";
          healthDataDisplay.style.display = "block";

          // Display Sex, Height, Weight, Age
          document.getElementById("display-sex-health").textContent = data.sex;
          document.getElementById(
            "display-height-health"
          ).textContent = `${data.height} cm`;
          document.getElementById(
            "display-weight-health"
          ).textContent = `${data.weight} kg`;
          document.getElementById(
            "display-age-health"
          ).textContent = `${data.age} years`; // Display Age

          // Display Blood Pressure without Analysis (remove analysis from here)
          document.getElementById("display-blood-pressure-health").textContent =
            data.bloodPressure || "Not available";

          // Display BP Analysis in a separate field
          const bpAnalysis = data.bpAnalysis || "No BP analysis available";
          document.getElementById("display-bp-analysis-health").textContent =
            bpAnalysis;

          // Display Sugar Level without Analysis (remove analysis from here)
          document.getElementById(
            "display-sugar-level-health"
          ).textContent = `${data.sugarLevel || "Not available"} mg/dL`;

          // Display Sugar Level Analysis in a separate field
          const sugarAnalysis =
            data.sugarAnalysis || "No sugar analysis available";
          document.getElementById("display-sugar-analysis-health").textContent =
            sugarAnalysis;

          // Menstrual Section
          if (data.sex === "female" && data.lastPeriod) {
            const { nextPeriod, phase, phaseInfo } = calculateNextPeriod(
              data.lastPeriod
            );

            let nextPhase = "";
            if (phase === "Menstrual Phase") nextPhase = "Follicular Phase";
            else if (phase === "Follicular Phase")
              nextPhase = "Ovulation Phase";
            else if (phase === "Ovulation Phase") nextPhase = "Luteal Phase";
            else if (phase === "Luteal Phase") nextPhase = "Menstrual Phase";

            nextPeriodSection.style.display = "block";
            displayNextPeriod.innerHTML = `
            <strong>Next Period Date:</strong> ${nextPeriod}<br>
            <strong>Current Phase:</strong> ${phase}<br>
            <strong>Next Phase:</strong> ${nextPhase}<br>
            <em>${phaseInfo}</em>
        `;
          } else {
            nextPeriodSection.style.display = "none";
          }
        }

        function showForm(data = null) {
          noHealthDataSection.style.display = "none";
          healthDataDisplay.style.display = "none";
          healthDataForm.style.display = "block";

          if (data) {
            document.getElementById("sex-health").value = data.sex;
            document.getElementById("age-health").value = data.age || ""; // Set age field
            document.getElementById("height-health").value = data.height;
            document.getElementById("weight-health").value = data.weight;
            document.getElementById("blood-pressure-health").value =
              data.bloodPressure;
            document.getElementById("sugar-level-health").value =
              data.sugarLevel;
            document.getElementById("last-period-health").value =
              data.lastPeriod || "";
            togglePeriodSection();
          }
        }

        function showData(data) {
          console.log("Displaying Health Data:", data);
          noHealthDataSection.style.display = "none";
          healthDataForm.style.display = "none";
          healthDataDisplay.style.display = "block";

          // Display Sex, Height, Weight, Age
          document.getElementById("display-sex-health").textContent = data.sex;
          document.getElementById(
            "display-height-health"
          ).textContent = `${data.height} cm`;
          document.getElementById(
            "display-weight-health"
          ).textContent = `${data.weight} kg`;
          document.getElementById(
            "display-age-health"
          ).textContent = `${data.age} years`; // Display Age

          // Display Blood Pressure without Analysis (remove analysis from here)
          document.getElementById("display-blood-pressure-health").textContent =
            data.bloodPressure || "Not available";

          // Display BP Analysis in a separate field
          const bpAnalysis = data.bpAnalysis || "No BP analysis available";
          document.getElementById("display-bp-analysis-health").textContent =
            bpAnalysis;

          // Display Sugar Level without Analysis (remove analysis from here)
          document.getElementById(
            "display-sugar-level-health"
          ).textContent = `${data.sugarLevel || "Not available"} mg/dL`;

          // Display Sugar Level Analysis in a separate field
          const sugarAnalysis =
            data.sugarAnalysis || "No sugar analysis available";
          document.getElementById("display-sugar-analysis-health").textContent =
            sugarAnalysis;

          // Menstrual Section
          if (data.sex === "female" && data.lastPeriod) {
            const { nextPeriod, phase, phaseInfo } = calculateNextPeriod(
              data.lastPeriod
            );

            let nextPhase = "";
            if (phase === "Menstrual Phase") nextPhase = "Follicular Phase";
            else if (phase === "Follicular Phase")
              nextPhase = "Ovulation Phase";
            else if (phase === "Ovulation Phase") nextPhase = "Luteal Phase";
            else if (phase === "Luteal Phase") nextPhase = "Menstrual Phase";

            nextPeriodSection.style.display = "block";
            displayNextPeriod.innerHTML = `
            <strong>Next Period Date:</strong> ${nextPeriod}<br>
            <strong>Current Phase:</strong> ${phase}<br>
            <strong>Next Phase:</strong> ${nextPhase}<br>
            <em>${phaseInfo}</em>
        `;
          } else {
            nextPeriodSection.style.display = "none";
          }
        }

        async function saveHealthData(e) {
          e.preventDefault();

          const formData = {
            sex: document.getElementById("sex-health").value,
            age: document.getElementById("age-health").value, // New age field
            height: document.getElementById("height-health").value,
            weight: document.getElementById("weight-health").value,
            bloodPressure: document.getElementById("blood-pressure-health")
              .value,
            sugarLevel: document.getElementById("sugar-level-health").value,
            lastPeriod:
              document.getElementById("last-period-health").value || null,
          };

          try {
            const response = await fetch("/dashboard/save-health-data", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ userEmail, ...formData }),
            });

            if (!response.ok) {
              const error = await response.json();
              alert(error.error || "Failed to save health data.");
              return;
            }

            const result = await response.json();
            alert(result.message || "Health data saved successfully!");

            // Reload the page after showing the success message
            if (response.ok) {
              window.location.reload(); // Reload the page
            } else {
              showData(formData); // Continue with your custom function if needed
            }
          } catch (error) {
            console.error("Error saving health data:", error);
            alert("An unexpected error occurred. Please try again later.");
          }
        }

        async function fetchHealthData() {
          console.log("Fetching Health Data...");

          try {
            const response = await fetch(
              `/dashboard/get-health-data?userEmail=${encodeURIComponent(
                userEmail
              )}`
            );
            console.log("Response Status:", response.status);

            const result = await response.json();
            console.log("Response Body:", result);

            if (response.ok) {
              if (result && result.healthData) {
                healthData = result.healthData;
                showData(healthData);
              } else {
                noHealthDataSection.style.display = "block";
              }
            } else {
              console.error(
                "Failed to fetch health data. Status:",
                response.status
              );
              noHealthDataSection.style.display = "block";
            }
          } catch (error) {
            console.error("Error fetching health data:", error);
            noHealthDataSection.style.display = "block";
          }
        }

        enterHealthDataButton.addEventListener("click", () => showForm());
        if (editHealthDataButton) {
          editHealthDataButton.addEventListener("click", () =>
            showForm(healthData)
          );
        }
        healthDataForm.addEventListener("submit", saveHealthData);
        sexDropdown.addEventListener("change", togglePeriodSection);

        fetchHealthData();

        // Prescription and report handling
        const prescriptionUploadInput = document.getElementById(
          "upload-prescription-health"
        );
        const prescriptionList = document.getElementById(
          "prescription-list-health"
        );
        const savePrescriptionButton = document.getElementById(
          "save-prescription-health"
        );

        const reportUploadInput = document.getElementById(
          "upload-report-health"
        );
        const reportList = document.getElementById("report-list-health");
        const saveReportButton = document.getElementById("save-report-health");

        async function uploadFile(formData, type, listElement) {
          try {
            const response = await fetch(`/dashboard/upload/${type}`, {
              method: "POST",
              body: formData,
            });

            if (response.ok) {
              const data = await response.json();

              // Add the success message to the list
              const li = document.createElement("li");
              li.textContent = data.message; // Assuming response contains a message field
              listElement.appendChild(li);

              // Show a success message at the top of the page
              const successMessage = document.createElement("div");
              successMessage.classList.add("success-message");
              successMessage.textContent = `${
                type.charAt(0).toUpperCase() + type.slice(1)
              } uploaded successfully!`;
              document.body.appendChild(successMessage);

              // Remove the success message after 5 seconds
              setTimeout(() => {
                successMessage.remove();
              }, 5000);

              return true;
            } else {
              const error = await response.json();
              alert(error.error || "Failed to upload file.");
            }
          } catch (error) {
            alert("Error uploading file.");
          }
          return false;
        }

        savePrescriptionButton.addEventListener("click", async () => {
          const file = prescriptionUploadInput.files[0];
          if (!file) {
            alert("Please select a file to save.");
            return;
          }
          const formData = new FormData();
          formData.append("file", file);
          formData.append("email", userEmail);

          const response = await uploadFile(
            formData,
            "prescription",
            prescriptionList
          );
          if (response) {
            prescriptionUploadInput.value = "";
            window.location.reload(); // Reload the page after successful upload
          }
        });

        saveReportButton.addEventListener("click", async () => {
          const file = reportUploadInput.files[0];
          if (!file) {
            alert("Please select a file to save.");
            return;
          }
          const formData = new FormData();
          formData.append("file", file);
          formData.append("email", userEmail);

          const response = await uploadFile(formData, "report", reportList);
          if (response) {
            reportUploadInput.value = "";
            window.location.reload(); // Reload the page after successful upload
          }
        });

        async function fetchPrescriptions() {
          try {
            const response = await fetch(
              `/dashboard/prescriptions?email=${encodeURIComponent(userEmail)}`
            );
            if (response.ok) {
              const prescriptions = await response.json();
              prescriptionList.innerHTML = "";

              if (prescriptions.length === 0) {
                const emptyMessage = document.createElement("li");
                emptyMessage.classList.add("empty");
                emptyMessage.textContent = "No prescriptions uploaded yet.";
                prescriptionList.appendChild(emptyMessage);
              } else {
                prescriptions.forEach((item) => {
                  const listItem = document.createElement("li");
                  listItem.classList.add("upload-item");

                  listItem.innerHTML = `
                    <div class="upload-item-content">
                        <span><strong>File:</strong> ${item.filename}</span>
                        <span><strong>Uploaded on:</strong> ${new Date(
                          item.uploaded_at
                        ).toLocaleString()}</span>
                    </div>
                    <div class="upload-item-actions">
                        <a href="${
                          item.file_path
                        }" target="_blank" class="btn btn-link">View</a>
                    </div>
                `;
                  prescriptionList.appendChild(listItem);
                });
              }
            } else {
              console.error(
                "Failed to fetch prescriptions:",
                response.statusText
              );
            }
          } catch (error) {
            console.error("Error fetching prescriptions:", error);
          }
        }

        async function fetchReports() {
          try {
            const response = await fetch(
              `/dashboard/reports?email=${encodeURIComponent(userEmail)}`
            );
            if (response.ok) {
              const reports = await response.json();
              reportList.innerHTML = "";

              if (reports.length === 0) {
                const emptyMessage = document.createElement("li");
                emptyMessage.classList.add("empty");
                emptyMessage.textContent = "No reports uploaded yet.";
                reportList.appendChild(emptyMessage);
              } else {
                reports.forEach((item) => {
                  const listItem = document.createElement("li");
                  listItem.classList.add("upload-item");

                  listItem.innerHTML = `
                    <div class="upload-item-content">
                        <span><strong>File:</strong> ${
                          item?.filename || "Unknown file"
                        }</span>
                        <span><strong>Uploaded on:</strong> ${
                          item?.uploaded_at
                            ? new Date(item.uploaded_at).toLocaleString()
                            : "Unknown date"
                        }</span>
                    </div>
                    <div class="upload-item-actions">
                        <a href="${
                          item?.file_path
                            ? item.file_path.replace(/\\/g, "/")
                            : "#"
                        }" target="_blank" class="btn btn-link">
                            View
                        </a>
                    </div>
                `;
                  reportList.appendChild(listItem);
                });
              }
            } else {
              console.error("Failed to fetch reports:", response.statusText);
            }
          } catch (error) {
            console.error("Error fetching reports:", error);
          }
        }

        fetchPrescriptions();
        fetchReports();
      };

      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("search-input");
        const searchResults = document.getElementById("search-results");

        searchInput.addEventListener("input", function () {
          const query = searchInput.value.trim();
          if (query.length > 2) {
            fetch(`/api/search?query=${query}`)
              .then((response) => response.json())
              .then((data) => {
                searchResults.style.display = "block";
                searchResults.innerHTML = "";

                if (data.hospitals.length > 0) {
                  const hospitalHeader = document.createElement("h3");
                  hospitalHeader.textContent = "Hospitals";
                  searchResults.appendChild(hospitalHeader);

                  data.hospitals.forEach((hospital) => {
                    const hospitalItem = document.createElement("div");
                    hospitalItem.textContent = `${hospital.name} - ${hospital.address}`;
                    hospitalItem.classList.add("hospital-item");
                    hospitalItem.addEventListener("click", function () {
                      let hospitalNameElement =
                        document.getElementById("hospital-name");
                      if (!hospitalNameElement) {
                        hospitalNameElement = document.createElement("div");
                        hospitalNameElement.id = "hospital-name";
                        hospitalNameElement.style.display = "none";
                        document.body.appendChild(hospitalNameElement);
                      }
                      hospitalNameElement.innerText = hospital.name;
                      redirectToDocPage();
                    });
                    searchResults.appendChild(hospitalItem);
                  });
                }

                if (data.doctors.length > 0) {
                  const doctorHeader = document.createElement("h3");
                  doctorHeader.textContent = "Doctors";
                  searchResults.appendChild(doctorHeader);

                  data.doctors.forEach((doctor) => {
                    const doctorItem = document.createElement("div");
                    doctorItem.textContent = `${doctor.name} (${doctor.specialization}) - ${doctor.hospital}`;
                    doctorItem.className = "search-doctor-item";

                    // Set onclick handler for doctor item
                    doctorItem.onclick = async () => {
                      try {
                        const response = await fetch(
                          `/api/get_doctor_id?name=${encodeURIComponent(
                            doctor.name
                          )}`
                        );
                        if (!response.ok)
                          throw new Error(
                            `Failed to fetch doctor ID for ${doctor.name}`
                          );

                        const data = await response.json();
                        if (data.doctorId) {
                          showDoctorModal(data.doctorId); // Pass doctorId to the modal function
                        } else {
                          console.error(
                            `Doctor ID not found for ${doctor.name}`
                          );
                        }
                      } catch (error) {
                        console.error("Error fetching doctor ID:", error);
                      }
                    };

                    // Append to searchResults container
                    searchResults.appendChild(doctorItem);
                  });
                }

                if (data.hospitals.length === 0 && data.doctors.length === 0) {
                  searchResults.textContent = "No results found";
                }
              })
              .catch((error) => console.error("Error:", error));
          } else {
            searchResults.style.display = "none";
          }
        });

        // Show Doctor Modal
        function showDoctorModal(doctorId) {
          fetch(`/doclist/doctor/${doctorId}`)
            .then((response) => {
              if (!response.ok)
                throw new Error("Failed to fetch doctor details");
              return response.json();
            })
            .then((doctor) => {
              // Populate the modal with doctor details
              document.getElementById("doctor-modal-name").innerText =
                doctor.name;
              document.getElementById("doctor-modal-specialization").innerText =
                doctor.specialization;
              document.getElementById(
                "doctor-modal-fees"
              ).innerText = `‚Çπ${doctor.fees}`; // Populating Fees
              document.getElementById("doctor-modal-hospital").innerText =
                doctor.hospital;
              document.getElementById("doctor-modal-description").innerHTML = `
    <p><strong><i class="fas fa-graduation-cap"></i> Degrees:</strong> ${doctor.degrees.join(
      ", "
    )}</p>
    <p><strong><i class="fas fa-briefcase-medical"></i> Experience:</strong> ${
      doctor.experience
    }</p>
    <p><strong><i class="fas fa-award"></i> Achievements:</strong> ${doctor.achievements.join(
      ", "
    )}</p>`;

              // Ensure the "Book Appointment" button exists
              const bookButton = document.getElementById(
                "book-appointment-button"
              );
              if (!bookButton) {
                console.error(
                  "Book Appointment button not found in the modal."
                );
                return; // Exit if the button is missing
              }

              // Add an event listener to the "Book Appointment" button
              bookButton.onclick = () => openAppointmentForm(doctor);

              // Show the modal
              document
                .getElementById("doctor-details-modal")
                .classList.add("active");
            })
            .catch((err) => console.error(err));
        }

        document.addEventListener("click", function (event) {
          if (
            !searchInput.contains(event.target) &&
            !searchResults.contains(event.target)
          ) {
            searchResults.style.display = "none";
          }
        });
      });

      // Open the modal and populate data
      function openAppointmentForm(doctor) {
        const userNameField = document.getElementById("uniqueUserName");
        const userEmailField = document.getElementById("uniqueUserEmail");
        const userContactField = document.getElementById("uniqueUserContact");
        const appointmentDateField = document.getElementById(
          "uniqueAppointmentDate"
        );
        const appointmentTimeField = document.getElementById(
          "uniqueAppointmentTime"
        );

        // Retain existing values if present
        userNameField.value = userNameField.value || "";
        userEmailField.value = userEmailField.value || "";
        userContactField.value = "";

        // Populate doctor details
        document.getElementById("uniqueDoctorName").innerText =
          doctor.name || "N/A";
        document.getElementById("uniqueDoctorSpecialization").innerText =
          doctor.specialization || "N/A";
        document.getElementById("uniqueDoctorHospital").innerText =
          doctor.hospital || "N/A";

        // Populate available dates and times
        appointmentDateField.innerHTML =
          '<option value="">Select Date</option>';
        appointmentTimeField.innerHTML =
          '<option value="">Select Time</option>';
        if (doctor.availability) {
          Object.keys(doctor.availability).forEach((date) => {
            appointmentDateField.innerHTML += `<option value="${date}">${date}</option>`;
          });

          appointmentDateField.addEventListener("change", () => {
            const selectedDate = appointmentDateField.value;
            appointmentTimeField.innerHTML =
              '<option value="">Select Time</option>';
            if (doctor.availability[selectedDate]) {
              Object.entries(doctor.availability[selectedDate]).forEach(
                ([time, slots]) => {
                  appointmentTimeField.innerHTML += `<option value="${time}">${time} - Slots: ${slots}</option>`;
                }
              );
            }
          });
        }

        document.getElementById("appointment-modal").classList.add("active");
      }

      // Hide the modal
      function hideModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.remove("active");
        } else {
          console.error(`Modal with ID '${modalId}' not found.`);
        }
      }

      // Handle form submission
      document
        .getElementById("uniqueAppointmentForm")
        .addEventListener("submit", (event) => {
          event.preventDefault();

          const name = document.getElementById("uniqueUserName").value.trim();
          const email = document.getElementById("uniqueUserEmail").value.trim();
          const phone = document
            .getElementById("uniqueUserContact")
            .value.trim();
          const date = document.getElementById("uniqueAppointmentDate").value;
          const time = document.getElementById("uniqueAppointmentTime").value;

          if (!name || !email || !phone || !date || !time) {
            alert("Please fill in all required fields.");
            return;
          }

          const doctorName =
            document.getElementById("uniqueDoctorName").innerText;
          const doctorSpecialization = document.getElementById(
            "uniqueDoctorSpecialization"
          ).innerText;
          const doctorHospital = document.getElementById(
            "uniqueDoctorHospital"
          ).innerText;
          const dateTime = `${date}T${time}:00`;

          const payload = {
            patient_name: name,
            phone,
            email,
            doctor_name: doctorName,
            doctor_specialization: doctorSpecialization,
            doctor_hospital: doctorHospital,
            date_time: dateTime,
          };

          console.log("Payload being sent:", payload);

          fetch("/doclist/appointment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          })
            .then(async (response) => {
              const data = await response.json();
              if (response.ok) {
                alert(data.message || "Appointment booked successfully!");
                hideModal("appointment-modal");
              } else {
                console.error("Server Error:", data);
                const errorMessage =
                  data.message || data.error || "An error occurred.";
                alert(errorMessage);

                // Optionally display available slots
                if (data.available_slots) {
                  console.log("Available Slots:", data.available_slots);
                  alert("Available slots: " + data.available_slots.join(", "));
                }
              }
            })
            .catch((error) => {
              console.error("Network Error:", error);
              alert("A network error occurred. Please try again.");
            });
        });

      
      let hospitals = []; // To store the list of hospitals

      document.addEventListener("DOMContentLoaded", () => {
        loadHospitalList();
      });
      
      function openBedVacancyModal() {
        const modal = document.getElementById("bedVacancyModal");
        if (modal) {
          modal.classList.add("active");
          modal.style.display = "block"; // Make sure the modal is visible
        } else {
          console.error("Bed vacancy modal not found.");
        }
      }

      function closeBedModal() {
        const modal = document.getElementById("bedVacancyModal");
        const bedDetails = document.getElementById("bedDetails");
        const bedList = document.getElementById("bedList");

        if (modal) {
          modal.classList.remove("active");
          modal.style.display = "none"; // Ensure the modal is hidden
        }
        if (bedDetails) {
          bedDetails.style.display = "none"; // Hide bed details
        }
        if (bedList) {
          bedList.innerHTML = ""; // Clear the bed list
        }

        // Reset form fields
        document.getElementById("bedForm").reset();
      }

      // Load the hospital list
      async function loadHospitalList() {
        const response = await fetch("/api/hospitals");
        hospitals = await response.json();
        populateHospitalDropdown(hospitals); // Populate dropdown when hospitals are loaded
      }

      // Function to filter hospitals as user types in the search input
      function filterHospitals() {
        const searchTerm = document
          .getElementById("hospitalSearch")
          .value.toLowerCase();
        const filteredHospitals = hospitals.filter((hospital) =>
          hospital.name.toLowerCase().includes(searchTerm)
        );
        populateHospitalDropdown(filteredHospitals);
      }

      // Function to populate the hospital dropdown list
      function populateHospitalDropdown(hospitals) {
        const dropdown = document.getElementById("hospitalName");
        dropdown.innerHTML = ""; // Clear existing options
        dropdown.innerHTML = "<option value=''>--Select Hospital--</option>"; // Reset first option
        hospitals.forEach((hospital) => {
          const option = document.createElement("option");
          option.value = hospital._id; // Ensure this matches the MongoDB ObjectId field
          option.textContent = hospital.name;
          dropdown.appendChild(option);
        });
      }

      // Handle the event when a hospital is selected
      document
        .getElementById("hospitalName")
        .addEventListener("change", async (e) => {
          const hospitalId = e.target.value;
          console.log("Selected Hospital ID:", hospitalId);

          if (hospitalId && hospitalId !== "undefined") {
            const response = await fetch(`/api/hospitals/${hospitalId}`);
            const hospital = await response.json();
            console.log(hospital);

            const bedTypeSelect = document.getElementById("bedType");
            bedTypeSelect.innerHTML =
              '<option value="">--Select Bed Type--</option>'; // Clear previous options

            if (hospital.bed_availability) {
              // Populate the bed type dropdown based on available bed types
              Object.entries(hospital.bed_availability).forEach(
                ([type, count]) => {
                  const option = document.createElement("option");
                  option.value = type;
                  option.textContent = `${type} (${count} available)`;
                  bedTypeSelect.appendChild(option);
                }
              );

              // Show bed details section
              document.getElementById("bedDetails").style.display = "block";
            } else {
              console.error("No bed availability data found.");
            }
          } else {
            console.error("Invalid Hospital ID");
          }
        });

      // Form submission for bed request
      document
        .getElementById("bedForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const hospitalId = document.getElementById("hospitalName").value;
          const bedType = document.getElementById("bedType").value; // Get selected bed type
          const userName = document.getElementById("userName").value;
          const userEmail = document.getElementById("userEmail").value;

          const payload = {
            hospitalId,
            bedType, // Include bed type in the payload
            userName,
            userEmail,
          };

          const response = await fetch("/api/requestBed", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (response.ok) {
            alert("Request sent successfully!");
            closeBedModal();
          } else {
            alert("Error sending request. Please try again.");
          }
        });

      function handleBookingAction() {
        redirectTohosPage(); // Directly redirect to the doctor page
      }


      function redirectTohosPage() {
        window.location.href = '/hosplist';
    }
    
      document.getElementById("logout-icon").addEventListener("click", (e) => {
        e.preventDefault(); // Prevent the default action
        fetch("/logout", { method: "POST" })
          .then((response) => {
            if (response.ok) {
              window.location.href = "/"; // Redirect to the landing page
            } else {
              console.error("Logout failed");
            }
          })
          .catch((error) => console.error("Error:", error));
      });

      // Modal functionality
      document.addEventListener("DOMContentLoaded", function () {
        const chatbotButton = document.querySelector(".chatbot-button");
        const chatbotModal = document.querySelector(".chatbot-modal");
        const closeModal = document.querySelector(".chatbot-modal-close");

        // Close modal
        closeModal.addEventListener("click", function () {
          chatbotModal.style.display = "none";
        });

        // Close modal when clicking outside of content
        window.addEventListener("click", function (e) {
          if (e.target === chatbotModal) {
            chatbotModal.style.display = "none";
          }
        });
      });
      
    


    document.addEventListener("DOMContentLoaded", function () {
      const waitingListContainer = document.getElementById("waiting-list");
    
      // Function to fetch waiting list data
      async function fetchWaitingList() {
        console.debug("Fetching waiting list data..."); // Debugging line
        try {
          const response = await fetch("/waiting-list/get-waiting-list");
          console.debug("Response received:", response); // Debugging line
          if (response.ok) {
            const data = await response.json();
            console.debug("Waiting list data fetched successfully:", data); // Debugging line
            displayWaitingList(data);
          } else if (response.status === 404) {
            console.warn("No ongoing appointments found."); // Debugging line
            waitingListContainer.innerHTML = "<p>No ongoing appointments found for today.</p>";
          } else {
            console.error("Error fetching waiting list data. Status:", response.status); // Debugging line
            waitingListContainer.innerHTML = "<p>Error fetching waiting list data.</p>";
          }
        } catch (error) {
          console.error("Error fetching waiting list data:", error); // Debugging line
          waitingListContainer.innerHTML = "<p>Failed to load waiting list.</p>";
        }
      }
    
      // Function to calculate expected appointment time
      function calculateExpectedTime(dateTime, estimatedWaitTime) {
        const appointmentTime = new Date(dateTime);
        const waitTimeParts = estimatedWaitTime.split(":"); // Format: HH:MM:SS
        const waitHours = parseInt(waitTimeParts[0], 10);
        const waitMinutes = parseInt(waitTimeParts[1], 10);
        const waitSeconds = parseInt(waitTimeParts[2], 10);
    
        // Add wait time to appointment time
        appointmentTime.setHours(appointmentTime.getHours() + waitHours);
        appointmentTime.setMinutes(appointmentTime.getMinutes() + waitMinutes);
        appointmentTime.setSeconds(appointmentTime.getSeconds() + waitSeconds);
    
        return appointmentTime.toLocaleString(); // Return the formatted date and time
      }
    
      // Function to display waiting list items
      function displayWaitingList(data) {
        console.debug("Displaying waiting list:", data); // Debugging line
        waitingListContainer.innerHTML = ""; // Clear existing content
    
        // Loop through each appointment in the data array
        data.forEach((appointment) => {
          const expectedTime = calculateExpectedTime(
            appointment.date_time,
            appointment.wait_time_info.estimated_wait_time
          );
    
          const listItem = document.createElement("div");
          listItem.className = "waiting-list-item";
          listItem.innerHTML = `
            <div class="appointment-card">
              <p><strong>Doctor Name:</strong> ${appointment.doctor_name}</p>
              <p><strong>Hospital Name:</strong> ${appointment.doctor_hospital}</p>
              <p><strong>Appointment Time:</strong> ${new Date(appointment.date_time).toLocaleString()}</p>
              <p><strong>Expected Time (After Wait):</strong> ${expectedTime}</p>
            </div>
            <hr>
          `;
          waitingListContainer.appendChild(listItem);
        });
      }
    
      // Fetch waiting list data on page load
      fetchWaitingList();
    });
    
    </script>

<!-- Place this at the end of the body -->
<script>
  document.addEventListener("DOMContentLoaded", function () { 
      console.log("‚úÖ DOM fully loaded and ready!");
  
      const sosButton = document.getElementById("sos-button");
      const sosStatus = document.getElementById("sos-status");
  
      if (!sosButton || !sosStatus) {
          console.error("‚ùå SOS button or status element not found in the DOM!");
          return;
      }
  
      let mediaRecorder;
      let audioChunks = [];
  
      // Function to handle SOS functionality
      async function handleSOS() {
          sosStatus.innerText = "Recording SOS message...";
          
          try {
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              mediaRecorder = new MediaRecorder(stream);
              mediaRecorder.start();
              audioChunks = [];
  
              mediaRecorder.ondataavailable = event => {
                  audioChunks.push(event.data);
              };
  
              mediaRecorder.onstop = async () => {
                  sosStatus.innerText = "Sending SOS...";
                  const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
                  const formData = new FormData();
                  formData.append("audio", audioBlob, "sos_audio.wav");
  
                  try {
                      const response = await fetch("/sos/upload", {
                          method: "POST",
                          body: formData
                      });
                      const data = await response.json();
                      sosStatus.innerText = data.message;
                  } catch (error) {
                      console.error("Error sending SOS:", error);
                      sosStatus.innerText = "Failed to send SOS.";
                  }
              };
  
              setTimeout(() => {
                  mediaRecorder.stop();
              }, 5000); // Stop recording after 5 seconds
          } catch (error) {
              console.error("Microphone access denied:", error);
              sosStatus.innerText = "Microphone access denied!";
          }
      }
  
      // Click event for the SOS button
      sosButton.addEventListener("click", handleSOS);
  
      // Keydown event for triggering SOS with Enter key
      document.addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
              sosButton.click(); // Simulates clicking the button
          }
      });
  });
  let times = [];

function openScheduleReminderModal() {
  document.getElementById("scheduleReminderModal").style.display = "block";
}

function closeScheduleReminderModal() {
  document.getElementById("scheduleReminderModal").style.display = "none";
}

function addTime() {
  const timeInput = document.getElementById("timeInput");
  const time = timeInput.value;

  if (time && !times.includes(time)) {
    times.push(time);

    const timeList = document.getElementById("timeList");
    const timeItem = document.createElement("div");
    timeItem.textContent = time;

    const removeButton = document.createElement("button");
    removeButton.textContent = "Remove";
    removeButton.onclick = () => {
      times = times.filter((t) => t !== time);
      timeList.removeChild(timeItem);
    };

    timeItem.appendChild(removeButton);
    timeList.appendChild(timeItem);

    timeInput.value = "";
  } else {
    alert("Invalid or duplicate time.");
  }
}

async function scheduleReminder() {
  const medicineName = document.getElementById("medicineName").value;
  const days = Array.from(document.getElementById("days").selectedOptions).map(
    (option) => option.value
  );
  const phone = document.getElementById("phone").value;

  if (times.length === 0) {
    alert("Please add at least one time.");
    return;
  }

  const response = await fetch("/schedule-reminder", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ medicineName, days, times, phone }),
  });

  if (response.ok) {
    alert("Reminder scheduled successfully!");
    times = []; // Reset times array
    document.getElementById("timeList").innerHTML = ""; // Clear time list
    closeScheduleReminderModal();
  } else {
    alert("Failed to schedule reminder.");
  }
}

  
  </script>

<!-- Your Firebase Initialization and Messaging Script -->

<script>
  // Firebase configuration
  const firebaseConfig = {
      apiKey: "AIzaSyAGweeKp0y0VZ7DeKxdKK8rhEnHhSGXRLc",
      authDomain: "auramed-994f3.firebaseapp.com",
      projectId: "auramed-994f3",
      storageBucket: "auramed-994f3.firebasestorage.app",
      messagingSenderId: "354809982629",
      appId: "1:354809982629:web:4ebfb32645b5afe795674c",
      measurementId: "G-RSXP7LNEJL"
  };

  console.log("Initializing Firebase...");
  try {
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      console.log("Firebase initialized successfully.");
  } catch (error) {
      console.error("Firebase initialization failed:", error);
  }

  // Register the Service Worker
  if ("serviceWorker" in navigator) {
      navigator.serviceWorker
      .register("/firebase-messaging-sw.js")
          .then((registration) => {
              console.log("Service Worker registered with scope:", registration.scope);

              // Initialize Firebase Messaging
              let messaging;
              try {
                  messaging = firebase.messaging();
                  console.log("Firebase Messaging initialized successfully.");

                  // Request Notification Permission
                  if (Notification.permission === "default") {
                      console.log("Requesting notification permission...");
                      Notification.requestPermission()
                          .then((permission) => {
                              if (permission === "granted") {
                                  console.log("Notification permission granted.");
                                  fetchFCMToken(messaging);
                              } else {
                                  console.warn("Notification permission not granted.");
                              }
                          })
                          .catch((error) => {
                              console.error("Error requesting notification permission:", error);
                          });
                  } else if (Notification.permission === "granted") {
                      console.log("Notification permission already granted.");
                      fetchFCMToken(messaging);
                  } else {
                      console.warn("Notification permission denied.");
                  }

                  // Handle Incoming Messages
                  messaging.onMessage((payload) => {
                      console.log("Message received while app is in focus:", payload);
                      alert(`Notification: ${payload.notification.title} - ${payload.notification.body}`);
                  });

              } catch (error) {
                  console.error("Firebase Messaging initialization failed:", error);
              }
          })
          .catch((error) => {
              console.error("Service Worker registration failed:", error);
          });
  } else {
      console.warn("Service Workers are not supported in this browser.");
  }

  // Function to fetch FCM token
  function fetchFCMToken(messaging) {
      console.log("Fetching FCM token...");
      messaging.getToken({
          vapidKey: "BGT-OSNmD8ENpzv10kgLl0Xzurrh1JPb7mf5f4hgK6fcZcZ_o5CRiT6hhl4SW4qMNuVWcfE4jkQKlQQmn25TYEg"
      })
          .then((token) => {
              if (token) {
                  console.log("FCM Token received:", token);
                  // Send this token to your backend for further processing
              } else {
                  console.warn("No FCM token available. Request permission to generate one.");
              }
          })
          .catch((error) => {
              console.error("Error fetching FCM token:", error);
          });
  }

</script>

</body>
</html>
